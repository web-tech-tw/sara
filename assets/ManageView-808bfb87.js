import{b as R,a as N,u as E,_ as O}from"./ToastModal-a32ea02b.js";import{C as I,b as S,d as P,o as p,c as g,a as e,t as y,z as b,w as $,j as U,F as M,D as V,l as q,h as j,E as H,i as D,r as _,G as A,H as L,g as B,A as G,B as F}from"./index-45c5ff98.js";const K={class:"flex justify-center my-8 py-16"},z={key:0},J={key:1},W={key:2,class:"flex flex-col mx-auto"},Q={class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"},X={class:"p-6 bg-white border-b border-gray-200"},Y={class:"p-6 bg-white border-b border-gray-200"},Z={class:"text-center text-slate-600"},ee=["onClick"],te={key:0,class:"p-6 bg-white border-b border-gray-200"},se={class:"list-disc ml-7"},oe={__name:"ManageProfileShow",emits:["state","status"],setup(f,{emit:x}){const{VITE_HOME_INTE_HOST:l,VITE_SARA_TOKEN_NAME:n,VITE_SARA_GUARD_NAME:i}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_RECV_HOST:"https://web-tech.tw/recv/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_SARA_GUARD_NAME:"guard_token",BASE_URL:"/sara/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},a=x,o=I({passkeys:[],isLoad:!0,isDead:!1}),s=S(()=>Array.isArray(o==null?void 0:o.roles)&&o.roles.length),c=S(()=>R()),v=()=>{localStorage.removeItem(n),localStorage.removeItem(i),location.replace(l)},m=()=>{a("state",{name:"ManageProfileDelete",props:{id:o._id,nickname:o.nickname,email:o.email,roles:o.roles}})},d=()=>{a("state",{name:"ManageProfileEdit",props:{nickname:o.nickname}})},u=w=>{a("state",{name:"ManagePasskeyShow",props:w})},t=async()=>{const w=E(),r=await w.post("users/me/passkeys"),{session_id:h,session_options:k}=await r.json();let T;try{T=await N({optionsJSON:k})}catch(C){console.error(C),a("status",{message:"通行金鑰新增失敗"});return}try{await w.patch("users/me/passkeys",{json:{session_id:h,credential:T}}),a("status",{message:"通行金鑰新增成功"}),setTimeout(()=>{location.reload()},1300)}catch(C){console.error(C),a("status",{message:"通行金鑰新增失敗"});return}};return P(async()=>{const w=E();try{const h=await(await w.get("users/me")).json(),{profile:k}=h;Object.assign(o,k),requestAnimationFrame(()=>{o.isLoad=!1})}catch(r){console.warn(r.message),o.isDead=!0}}),(w,r)=>(p(),g("div",K,[o.isDead?(p(),g("div",z," 發生錯誤 ")):o.isLoad?(p(),g("div",J," 載入中... ")):(p(),g("div",W,[e("div",Q," 您好，"+y(o.nickname)+"，這裡是您的個人資料： ",1),e("div",X,[r[0]||(r[0]=e("span",{class:"text-gray-600"},"暱稱：",-1)),b(y(o.nickname),1),r[1]||(r[1]=e("br",null,null,-1)),r[2]||(r[2]=e("span",{class:"text-gray-600"},"電子郵件地址：",-1)),b(y(o.email),1),r[3]||(r[3]=e("br",null,null,-1)),r[4]||(r[4]=e("span",{class:"text-gray-600"},"Sara 系統使用者識別碼：",-1)),b(y(o._id),1)]),e("div",{class:"p-6 bg-white border-b border-gray-200 text-right"},[e("button",{class:"bg-amber-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-amber-600 rounded mr-3",onClick:v}," 登出 "),e("button",{class:"bg-red-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-red-600 rounded mr-3",onClick:m}," 刪除帳號 "),e("button",{class:"bg-sky-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-sky-600 rounded",onClick:d}," 修改個人資料 ")]),e("div",Y,[r[6]||(r[6]=e("span",{class:"text-gray-600"},"通行金鑰：",-1)),$(e("div",Z," 尚未設定通行金鑰 ",512),[[U,!o.passkeys.length]]),e("div",null,[(p(!0),g(M,null,V(o.passkeys,(h,k)=>(p(),g("button",{key:k,class:"w-full bg-white text-sm text-slate-700 font-bold py-3 md:px-8 px-4 my-1 hover:bg-slate-300 rounded",onClick:T=>u(h)},y(h.label),9,ee))),128))]),c.value?(p(),g("button",{key:0,class:"w-full bg-white shadow-md text-sm text-slate-700 font-bold py-3 md:px-8 px-4 my-3 hover:bg-slate-300 rounded",onClick:t},[q(j(H),{class:"w-6 h-6 inline-block -mt-1 mr-2"}),r[5]||(r[5]=b(" 新增通行金鑰 "))])):D("",!0)]),s.value?(p(),g("div",te,[r[7]||(r[7]=e("span",{class:"text-gray-600"},"持有權限烙印：",-1)),e("ul",se,[(p(!0),g(M,null,V(o.roles,(h,k)=>(p(),g("li",{key:k},y(h),1))),128))])])):D("",!0)]))]))}},ae={class:"flex justify-center my-8 py-16"},ne={class:"flex flex-col mx-auto"},re={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},le={class:"overflow-hidden shadow-md"},ie={class:"p-6 bg-white border-b border-gray-200"},de={class:"rounded bg-white md:flex"},ue=["disabled"],pe={class:"p-6 bg-white border-gray-200 text-right"},be=["disabled"],ce=["disabled"],me={__name:"ManageProfileEdit",props:{nickname:{type:String,required:!0}},emits:["state","status"],setup(f,{emit:x}){const l=f,n=x,i=_(!1),a=_(!1),o=I({nickname:l.nickname}),s=S(()=>i.value||a.value),c=()=>{n("state",{name:"ManageUpdateEmailRequest"})},v=()=>{location.reload()},m=async()=>{await E().put("users/me",{json:o}),a.value=!0,n("status",{message:"修改成功"}),setTimeout(()=>{location.reload()},1300)},d=async()=>{i.value=!0,await m(),i.value=!1};return(u,t)=>(p(),g("div",ae,[e("div",ne,[e("div",re,[e("div",le,[t[4]||(t[4]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 修改個人資料： ",-1)),e("div",ie,[e("div",de,[t[1]||(t[1]=e("label",{class:"w-full py-1 text-gray-600 md:w-16",for:"nickname"}," 暱稱： ",-1)),$(e("input",{id:"nickname","onUpdate:modelValue":t[0]||(t[0]=w=>o.nickname=w),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none rounded my-3 md:my-0 focus:ring",placeholder:"星川 サラ",type:"text",disabled:s.value},null,8,ue),[[A,o.nickname]])])]),e("div",{class:"p-6 bg-white border-b border-gray-200"},[t[2]||(t[2]=b(" 若要修改電子郵件地址，請點 ")),e("span",{class:"cursor-pointer text-sky-500 hover:text-sky-700",onClick:c}," 此處 "),t[3]||(t[3]=b(" 。 "))]),e("div",pe,[e("button",{class:"bg-sky-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-sky-600 rounded mr-3",disabled:s.value,onClick:d}," 確定修改 ",8,be),e("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",disabled:s.value,onClick:v}," 取消 ",8,ce)])])])])]))}},ge={class:"flex justify-center my-8 py-16"},ye={class:"flex flex-col mx-auto"},xe={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},ve={class:"overflow-hidden shadow-md"},_e={class:"p-6 bg-white border-b border-gray-200"},we={class:"p-6"},fe={class:"p-6"},he={class:"p-6 bg-white border-b border-gray-200"},ke={class:"rounded bg-white md:flex"},Se=["disabled"],Ee={class:"p-6 bg-white border-gray-200 text-right"},$e=["disabled"],Ae=["disabled"],Te={__name:"ManageProfileDelete",props:{id:{type:String,required:!0},nickname:{type:String,required:!0},email:{type:String,required:!0},roles:{type:Array,required:!0}},emits:["status"],setup(f,{emit:x}){const{VITE_HOME_INTE_HOST:l}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_RECV_HOST:"https://web-tech.tw/recv/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_SARA_GUARD_NAME:"guard_token",BASE_URL:"/sara/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},n=f,i=x,a=_(!1),o=_(!1),s=_(""),c=S(()=>a.value||o.value),v=()=>{location.reload()},m=async()=>{await E().delete("users/me"),o.value=!0,i("status",{message:"刪除成功"}),setTimeout(()=>{location.replace(l)},1300)},d=async()=>{const{value:u}=s;if(u!=="DELETE"){i("status",{message:"請輸入 DELETE 以確認刪除"});return}a.value=!0,await m(),a.value=!1};return(u,t)=>(p(),g("div",ge,[e("div",ye,[e("div",xe,[e("div",ve,[t[14]||(t[14]=L('<div class="px-6 py-4 bg-white border-b border-gray-200 font-bold"> 刪除帳號 </div><div class="p-6 bg-white border-b border-gray-200 text-red-600"> ⚠️ 請注意，刪除帳號後，所有資料將無法復原。 </div><div class="p-6 bg-white border-b border-gray-200"><p class="text-amber-500"> ‼️ 刪除並非完全抹除 ‼️ </p> 本系統將保留您的「Sara 系統使用者識別碼」以供您先前曾使用的服務繼續應用，但會將您的暱稱及電子郵件地址設為無效值。<br> 這意味著，您將 <span class="text-red-600">永久喪失</span> 本帳號的存取權限，您將不再被識別為「同一個使用者」。但您的互動紀錄仍會保留在系統中作為服務參照。 <div class="my-3"> 以下是將被刪除的資料： <ul class="list-disc ml-6"><li>暱稱</li><li>電子郵件地址</li><li>您對本「Sara 系統使用者識別碼」之存取權限</li></ul></div> 在帳號刪除後，您將無法再次使用此帳號登入本系統。<br> 但您可使用相同的電子郵件地址重新註冊新帳號。 </div><div class="p-6 bg-white border-b border-gray-200 text-red-600"> 請注意，刪除帳號後，所有資料將無法復原。<br> 本操作無法撤銷，請謹慎考慮。<br> 若確定刪除，請輸入 DELETE 以確認。 </div>',4)),e("div",_e,[t[11]||(t[11]=b(" 將被刪除的帳號資訊如下： ")),e("div",we,[t[1]||(t[1]=e("span",{class:"text-gray-600"},"暱稱：",-1)),b(y(n.nickname),1),t[2]||(t[2]=e("br",null,null,-1)),t[3]||(t[3]=e("span",{class:"text-gray-600"},"電子郵件地址：",-1)),b(y(n.email),1),t[4]||(t[4]=e("br",null,null,-1)),t[5]||(t[5]=e("span",{class:"text-red-600"},"（資料將會立即抹除，不會保存您的資訊）",-1))]),t[12]||(t[12]=b(" 將解除存取權限的使用者識別碼如下： ")),e("div",fe,[t[6]||(t[6]=e("span",{class:"text-gray-600"},"Sara 系統使用者識別碼：",-1)),b(y(n.id),1),t[7]||(t[7]=e("br",null,null,-1)),t[8]||(t[8]=e("span",{class:"text-gray-600"},"Sara 系統權限烙印：",-1)),b(y(n.roles.length)+" 組",1),t[9]||(t[9]=e("br",null,null,-1)),t[10]||(t[10]=e("span",{class:"text-red-600"},"（資料仍會保留在系統中，但將無法再次使用）",-1))])]),e("div",he,[e("div",ke,[t[13]||(t[13]=e("label",{class:"w-full py-1 text-gray-600 md:w-16",for:"confirm"}," 刪除： ",-1)),$(e("input",{id:"confirm","onUpdate:modelValue":t[0]||(t[0]=w=>s.value=w),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none rounded my-3 md:my-0 focus:ring",placeholder:"若確定刪除，請輸入 DELETE",type:"text",disabled:c.value},null,8,Se),[[A,s.value]])])]),e("div",Ee,[e("button",{class:"bg-red-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-red-600 rounded mr-3",disabled:c.value,onClick:d}," 確定刪除 ",8,$e),e("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",disabled:c.value,onClick:v}," 取消 ",8,Ae)])])])])]))}},Ce={class:"flex justify-center my-8 py-16"},Me={class:"flex flex-col mx-auto"},Ve={class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"},De={class:"p-6 bg-white border-b border-gray-200"},Ie={__name:"ManagePasskeyShow",props:{id:{type:String,required:!0},label:{type:String,required:!0},publicKey:{type:String,required:!0},counter:{type:Number,required:!0},transports:{type:Array,required:!0},createdAt:{type:String,required:!0},updatedAt:{type:String,required:!0}},emits:["state","status"],setup(f,{emit:x}){const l=f,n=x,i=()=>{n("status",{message:"尚未實作"})},a=()=>{n("state",{name:"ManageProfileShow"})};return(o,s)=>(p(),g("div",Ce,[e("div",Me,[e("div",Ve," Passkey 通行金鑰 — "+y(l.label),1),e("div",De,[s[0]||(s[0]=e("span",{class:"text-gray-600"},"金鑰識別碼: ",-1)),b(y(l.id),1),s[1]||(s[1]=e("br",null,null,-1)),s[2]||(s[2]=e("span",{class:"text-gray-600"},"使用次數*: ",-1)),b(y(l.counter),1),s[3]||(s[3]=e("br",null,null,-1)),s[4]||(s[4]=e("span",{class:"text-gray-600"},"傳輸機制: ",-1)),b(y(l.transports.join(", ")),1),s[5]||(s[5]=e("br",null,null,-1)),s[6]||(s[6]=e("span",{class:"text-gray-600"},"建立時間: ",-1)),b(y(l.createdAt),1),s[7]||(s[7]=e("br",null,null,-1)),s[8]||(s[8]=e("span",{class:"text-gray-600"},"更新時間: ",-1)),b(y(l.updatedAt),1),s[9]||(s[9]=e("br",null,null,-1))]),s[10]||(s[10]=e("div",{class:"p-6 bg-white border-b border-gray-200 text-sm text-gray-600"}," * 對於 Apple Inc. 所生產的裝置， 基於該製造商對於 Passkey 通行金鑰的設計， 使用次數僅供參考（可能永久為 0）， 實際使用次數可能因為 Apple Inc. 的實作方式而有所不同。 ",-1)),e("div",{class:"p-6 bg-white border-gray-200 text-right"},[e("button",{class:"bg-sky-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-sky-600 rounded mr-3",onClick:i}," 修改 "),e("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:a}," 返回 ")])])]))}},qe={class:"flex justify-center my-8 py-16"},Re={class:"flex flex-col mx-auto"},Ne={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},Oe={class:"overflow-hidden shadow-md"},Pe={class:"p-6 bg-white border-b border-gray-200"},Ue={class:"rounded bg-white md:flex"},je=["disabled"],He={class:"p-6 bg-white border-gray-200 text-right"},Le=["disabled"],Be=["disabled"],Ge={__name:"ManageUpdateEmailRequest",emits:["state","status"],setup(f,{emit:x}){const l=x,n=_(!1),i=_(!1),a=_(""),o=S(()=>n.value||i.value),s=()=>{location.reload()},c=async m=>{const t=await(await E().put("users/me/email",{json:{email:m}})).json();i.value=!0,l("state",{name:"ManageUpdateEmailVerify",props:{sessionId:t.session_id,sessionTm:t.session_tm,sessionUa:t.session_ua,sessionIp:t.session_ip,currentMail:m}})},v=async()=>{const{value:m}=a;if(!m){l("status",{message:"請輸入新的電子郵件地址"});return}n.value=!0,await c(m),n.value=!1};return(m,d)=>(p(),g("div",qe,[e("div",Re,[e("div",Ne,[e("div",Oe,[d[2]||(d[2]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 修改電子郵件地址： ",-1)),e("div",Pe,[e("div",Ue,[d[1]||(d[1]=e("label",{class:"w-full py-1 text-gray-600 md:w-64",for:"email"}," 新的電子郵件地址： ",-1)),$(e("input",{id:"email","onUpdate:modelValue":d[0]||(d[0]=u=>a.value=u),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none rounded my-3 md:my-0 focus:ring",placeholder:"例如：sara@web-tech.tw",type:"email",disabled:o.value},null,8,je),[[A,a.value]])])]),e("div",He,[e("button",{class:"bg-sky-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-sky-600 rounded mr-3",disabled:o.value,onClick:v}," 確定修改 ",8,Le),e("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",disabled:o.value,onClick:s}," 取消 ",8,Be)])])])])]))}},Fe={class:"flex justify-center my-8 py-16"},Ke={class:"flex flex-col mx-auto"},ze={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},Je={class:"overflow-hidden shadow-md"},We={class:"p-6 bg-white border-b border-gray-200"},Qe={class:"rounded bg-white md:flex"},Xe=["disabled"],Ye={class:"p-6 bg-white border-gray-200 text-right"},Ze=["disabled"],et=["disabled"],tt={__name:"ManageUpdateEmailVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["status"],setup(f,{emit:x}){const l=f,n=x,i=_(!1),a=_(!1),o=_(""),s=S(()=>i.value||a.value),c=()=>{location.reload()},v=async d=>{await E().patch("users/me/email",{json:{session_id:l.sessionId,code:d}}),a.value=!0,n("status",{message:"修改成功"}),setTimeout(()=>{location.reload()},1300)},m=async()=>{const{value:d}=o;if(!d){n("status",{message:"請輸入轉移代碼"});return}i.value=!0,await v(d),i.value=!1};return(d,u)=>(p(),g("div",Fe,[e("div",Ke,[e("div",ze,[e("div",Je,[u[2]||(u[2]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 修改電子郵件地址： ",-1)),e("div",We,[e("div",Qe,[u[1]||(u[1]=e("label",{class:"w-full py-1 text-gray-600 md:w-64",for:"code"}," 轉移代碼： ",-1)),$(e("input",{id:"code","onUpdate:modelValue":u[0]||(u[0]=t=>o.value=t),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none rounded my-3 md:my-0 focus:ring",placeholder:"例如：12345678",type:"text",disabled:s.value},null,8,Xe),[[A,o.value]])])]),e("div",Ye,[e("button",{class:"bg-sky-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-sky-600 rounded mr-3",disabled:s.value,onClick:m}," 確定修改 ",8,Ze),e("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",disabled:s.value,onClick:c}," 取消 ",8,et)])])])])]))}},at={__name:"ManageView",setup(f){const x=_("ManageProfileShow"),l=_(null),n=_(""),i={ManageProfileShow:oe,ManageProfileEdit:me,ManageProfileDelete:Te,ManagePasskeyShow:Ie,ManageUpdateEmailRequest:Ge,ManageUpdateEmailVerify:tt},a=S(()=>i[x.value]),o=({name:c,props:v})=>{x.value=c,l.value=v??{},requestAnimationFrame(()=>{window.scroll({behavior:"smooth",top:0})})},s=({message:c})=>{n.value=c};return(c,v)=>(p(),g(M,null,[(p(),B(F(a.value),G(l.value,{onState:o,onStatus:s}),null,16)),q(O,{modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=m=>n.value=m)},null,8,["modelValue"])],64))}};export{at as default};
