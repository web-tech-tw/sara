import{r as c,u as w,c as m,g as S,o as k,a as V,b as l,t as v,d as j,F as C,e as E,f as I}from"./index-9ed4bb42.js";import{_ as R}from"./InputModal-78a93c31.js";const q={class:"flex justify-center my-8 py-16"},B={class:"flex flex-col"},$={class:"input-label text-base mb-2"},F={class:"input-label text-base mb-2 text-red-600"},D={__name:"RegisterView",props:{email:{type:String,required:!0}},setup(M){const u=c(!1),t=c(""),r=c(""),i=c(""),d=w(),p=I(),_=m(()=>r.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),g=m(()=>r.value?"例如：1234567":"例如：星川 サラ"),f=m(()=>r.value?"請於您的電子郵件信箱收取註冊代碼。":""),b=()=>{window.history.length?d.back():d.replace("/")},h=async e=>{if(!e){t.value="請輸入資料";return}t.value="",u.value=!0,r.value?await y(e):await x(e),u.value=!1},x=async e=>{var s;const a=sessionStorage.getItem("sara_register_email");try{const n=await(await p.post("users",{json:{email:a,nickname:e}})).json();n!=null&&n.session_id?(r.value=n.session_id,i.value=""):t.value="發生錯誤 (無錯誤代碼)"}catch(o){const n=((s=o==null?void 0:o.response)==null?void 0:s.status)||"無錯誤代碼";t.value=`發生錯誤 (${n})`,console.error(o.message)}},y=async e=>{var a;try{await p.patch("users",{json:{session_id:r.value,code:e}}),t.value="註冊成功，正在寫入憑證...",i.value="",sessionStorage.removeItem("sara_register_email"),E()}catch(s){const o=((a=s==null?void 0:s.response)==null?void 0:a.status)||"無錯誤代碼";t.value=`發生錯誤 (${o})`,console.error(s.message)}};return S(()=>{sessionStorage.getItem("sara_register_email")||d.replace("/")}),(e,a)=>(k(),V(C,null,[l("div",q,[l("div",B,[l("label",$,v(_.value),1),l("p",F,v(t.value),1),j(R,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=s=>i.value=s),loading:u.value,placeholder:g.value,description:f.value,onSubmit:h},null,8,["modelValue","loading","placeholder","description"])])]),l("div",{class:"flex justify-center mt-5"},[l("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:b}," 取消 ")])],64))}};export{D as default};
