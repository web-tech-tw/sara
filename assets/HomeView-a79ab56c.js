import{o as p,c as k,a as e,n as K,m as E,u as O,r as m,b as M,d as R,e as Z,w as P,v as J,f as W,g as q,h as I,i as N,j as G,k as D,l as A,t as y,p as Q,q as j,s as X,F as T,x as Y,y as H,z as B,A as S,B as ee,C as se}from"./index-764056c4.js";import{b as te,s as oe,u as U,_ as ne}from"./ToastModal-d265630d.js";const F={__name:"LoadingCircleIcon",props:{class:{type:String,required:!1,default:()=>""}},setup(b){const f=b;return(s,t)=>(p(),k("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:K(f.class)},t[0]||(t[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M 3 11.958 C 3.205 6.522 7.226 2.994 11.995 2.993 L 11.954 1.007 C 5.327 1.007 1.002 5.322 1.002 11.949 L 3 11.958 Z M 5.285 17.992 C 3.993 16.533 2.997 13.906 3 11.957 L 1 11.948 C 1 14.99 1.927 17.208 3.792 19.322 L 5.285 17.992 Z"},null,-1)]),2))}},ae={class:"input-modal"},ie={class:"flex rounded bg-white w-auto h-16 shadow-md md:w-[30rem]"},le=["placeholder","type","disabled"],re=["disabled"],ue=["disabled"],ce={class:"text-base mt-2"},L={__name:"InputModal",props:E({inputPlaceholder:{type:String,required:!1,default:()=>""},inputDescription:{type:String,required:!1,default:()=>""},inputType:{type:String,required:!1,default:()=>"text"},inputHistory:{type:String,required:!1,default:()=>""},isLoad:{type:Boolean,required:!1,default:()=>!0},isDone:{type:Boolean,required:!1,default:()=>!1},noSubmit:{type:Boolean,required:!1,default:()=>!1}},{modelValue:{type:String},modelModifiers:{}}),emits:E(["submit"],["update:modelValue"]),setup(b,{emit:f}){const s=b,t=O(b,"modelValue"),u=f,a=m(!1),c=M(()=>!!s.inputHistory&&!t.value&&a.value),o=M(()=>s.isLoad||s.isDone),v=()=>{t.value=s.inputHistory,a.value=!1},d=()=>{a.value=!0},n=r=>{document.querySelector(".input-modal").contains(r.target)||(a.value=!1)},i=()=>{u("submit",t.value)};return R(()=>{document.addEventListener("click",n)}),Z(()=>{document.removeEventListener("click",n)}),(r,l)=>(p(),k("div",ae,[e("div",ie,[P(e("input",{"onUpdate:modelValue":l[0]||(l[0]=x=>t.value=x),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none focus:outline-none",placeholder:s.inputPlaceholder,type:s.inputType,disabled:o.value,onFocus:d,onKeydown:W(i,["enter"])},null,40,le),[[J,t.value]]),s.noSubmit?D("",!0):(p(),k("button",{key:0,class:"m-2 rounded px-4 py-2 font-semibold",disabled:o.value,onClick:i},[s.isDone?(p(),q(I(N),{key:0,class:"h-6 w-6 my-1"})):s.isLoad?(p(),q(F,{key:1,class:"h-6 w-6 my-1 animate-spin"})):(p(),q(I(G),{key:2,class:"h-6 w-6 my-1"}))],8,re))]),P(e("button",{class:"w-[90%] mx-auto flex items-center space-x-2 bg-white-500 shadow-md text-md text-slate-700 font-normal py-3 md:px-8 px-4 hover:bg-slate-100 rounded mt-1 animate-fade",disabled:o.value,onClick:v},y(s.inputHistory),9,ue),[[A,c.value]]),e("p",ce,y(s.description),1)]))}},de={class:"flex justify-center my-8 py-16"},pe={class:"flex flex-col mx-5"},me={key:0,class:"flex justify-center mt-5"},ye={key:1,class:"flex justify-center mt-5"},fe="請輸入您的電子郵件地址：",be="例如：sara@web-tech.tw",ve="email",xe={__name:"CreateTokenRequest",emits:["state","status"],setup(b,{emit:f}){const s=m(""),t=m(""),u=m(!1),a=m(!1),c=m(!1),o=m(!1),v=M(()=>te()&&!o.value),d=M(()=>!!t.value),n=f,i=async()=>{const{value:_}=s;if(!_){n("status",{message:"請輸入電子郵件地址"});return}u.value=!0,await l(_),u.value=!1},r=()=>{Y(),t.value="",n("status",{message:"成功清除登入記錄"})},l=async _=>{var $;const g=U();try{c.value=!0;const C=await g.post("tokens/passkeys",{json:{email:_}}),{session_id:h,session_options:w}=await C.json(),z=await oe({optionsJSON:w});await g.patch("tokens/passkeys",{json:{session_id:h,credential:z}}),a.value=!0,n("status",{message:"登入成功，正在寫入憑證..."}),H(_),B()}catch(C){console.error(C);const h=(($=C==null?void 0:C.response)==null?void 0:$.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${h})`}),c.value=!1}},x=async _=>{var $,C;const g=U();try{o.value=!0;const w=await(await g.post("tokens",{json:{email:_}})).json();if(!(w!=null&&w.session_id)){n("status",{message:"發生錯誤 (無錯誤代碼)"});return}n("state",{name:"CreateTokenVerify",props:{sessionId:w.session_id,sessionTm:w.session_tm,sessionUa:w.session_ua,sessionIp:w.session_ip,currentMail:_}})}catch(h){if((($=h==null?void 0:h.response)==null?void 0:$.status)===404){n("state",{name:"CreateTokenEmpty",props:{currentMail:_}});return}console.error(h);const w=((C=h==null?void 0:h.response)==null?void 0:C.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${w})`}),o.value=!1}},V=async _=>{if(!_){n("status",{message:"請輸入電子郵件地址"});return}u.value=!0,await x(_),u.value=!1};return R(()=>{t.value=Q()}),(_,g)=>(p(),k(T,null,[e("div",de,[e("div",pe,[e("label",{class:"input-label text-base mb-2"},y(fe)),j(L,{modelValue:s.value,"onUpdate:modelValue":g[0]||(g[0]=$=>s.value=$),"input-placeholder":be,"input-type":ve,"input-history":t.value,"is-load":u.value,"is-done":a.value,"no-submit":c.value,onSubmit:V},null,8,["modelValue","input-history","is-load","is-done","no-submit"])])]),v.value?(p(),k("div",me,[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:i},[e("span",null,[a.value?(p(),q(I(N),{key:0,class:"h-5 w-5"})):u.value?(p(),q(F,{key:1,class:"h-5 w-5 animate-spin"})):(p(),q(I(X),{key:2,class:"h-5 w-5"}))]),g[1]||(g[1]=e("span",{class:"font-bold"}," Passkey ",-1))])])):D("",!0),d.value?(p(),k("div",ye,[e("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:r},g[2]||(g[2]=[e("span",{class:"font-bold"}," 清除登入記錄 ",-1)]))])):D("",!0)],64))}},_e={class:"flex justify-center my-8 py-16"},he={class:"flex flex-col max-w-2xl mx-auto"},ge={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},we={class:"overflow-hidden shadow-md"},ke={class:"p-6 bg-white border-b border-gray-200"},Ce={class:"text-slate-900 my-3"},Se={__name:"CreateTokenEmpty",props:{currentMail:{type:String,required:!0}},emits:["state"],setup(b,{emit:f}){const s=b,t=f,u=()=>{t("state",{name:"CreateUserRequest",props:{currentMail:s.currentMail}})},a=()=>{location.reload()};return(c,o)=>(p(),k("div",_e,[e("div",he,[e("div",ge,[e("div",we,[o[2]||(o[2]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 尚未註冊 ",-1)),e("div",ke,[o[0]||(o[0]=S(" 您好，您輸入的電子郵件地址： ")),e("div",Ce,y(s.currentMail),1),o[1]||(o[1]=S(" 尚未於 Sara 系統註冊帳號。 "))]),o[3]||(o[3]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您確定曾經註冊過："),e("br"),S(" 請檢查您輸入的電子郵件地址，"),e("br"),S(" 並點選「取消」以重新輸入。 ")],-1)),o[4]||(o[4]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您未曾註冊："),e("br"),S(" 請點選「註冊」以進行註冊。"),e("br"),S(" 註冊即代表您同意我們的 "),e("a",{href:"https://web-tech.tw/#/privacy",class:"text-sky-500 hover:text-sky-700",target:"_blank"}," 隱私權政策 "),S("。 ")],-1)),e("div",{class:"p-6 bg-white border-b border-gray-200 text-right"},[e("button",{class:"bg-amber-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-amber-600 rounded mr-3",onClick:u}," 註冊 "),e("button",{class:"bg-white shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:a}," 取消 ")])])])])]))}},$e={class:"flex justify-center my-8 py-16"},qe={class:"flex flex-col mx-5"},Ve={class:"text-center text-slate-700 mt-5 text-sm"},Me={class:"text-center text-slate-700 mt-5 text-sm"},Ue="請輸入您的登入代碼：",je="例如：123456",Te={__name:"CreateTokenVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["status"],setup(b,{emit:f}){const s=b,t=f,u=`請於您的電子郵件信箱 ${s.currentMail} 收取登入代碼。`,a=m(""),c=m(!1),o=m(!1),v=()=>{location.reload()},d=async i=>{var l;const r=U();try{await r.patch("tokens",{json:{session_id:s.sessionId,code:i}}),o.value=!0,t("status",{message:"登入成功，正在寫入憑證..."}),H(s.currentMail),B()}catch(x){console.error(x);const V=((l=x==null?void 0:x.response)==null?void 0:l.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${V})`})}},n=async i=>{if(!i){t("status",{message:"請輸入登入代碼"});return}c.value=!0,await d(i),c.value=!1};return(i,r)=>(p(),k(T,null,[e("div",$e,[e("div",qe,[e("label",{class:"input-label text-base mb-2"},y(Ue)),j(L,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=l=>a.value=l),"input-description":u,"input-placeholder":je,"is-load":c.value,"is-done":o.value,onSubmit:n},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:v}," 取消 ")]),e("div",Ve,[e("div",null,"申請時間："+y(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+y(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+y(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+y(s.sessionIp||"未知"),1)]),e("div",Me,[e("div",null,"目標電子郵件地址："+y(s.currentMail||"未知"),1)])],64))}},Ie={class:"flex justify-center my-8 py-16"},Le={class:"flex flex-col mx-5"},Pe={class:"text-center text-slate-700 mt-5 text-sm"},De="請輸入您的暱稱：",He="例如：星川 サラ",Be={__name:"CreateUserRequest",props:{currentMail:{type:String,required:!0}},emits:["state","status"],setup(b,{emit:f}){const s=b,t=f,u=m(""),a=m(!1),c=()=>{location.reload()},o=async d=>{var i;const n=U();try{const l=await(await n.post("users",{json:{email:s.currentMail,nickname:d}})).json();t("state",{name:"CreateUserVerify",props:{sessionId:l.session_id,sessionTm:l.session_tm,sessionUa:l.session_ua,sessionIp:l.session_ip,currentMail:s.currentMail}})}catch(r){console.error(r);const l=((i=r==null?void 0:r.response)==null?void 0:i.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${l})`})}},v=async d=>{if(!d){t("status",{message:"請輸入暱稱"});return}a.value=!0,await o(d),a.value=!1};return(d,n)=>(p(),k(T,null,[e("div",Ie,[e("div",Le,[e("label",{class:"input-label text-base mb-2"},y(De)),j(L,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=i=>u.value=i),"input-placeholder":He,"is-load":a.value,onSubmit:v},null,8,["modelValue","is-load"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:c}," 取消 ")]),e("div",Pe,[e("div",null,"目標電子郵件地址："+y(s.currentMail||"未知"),1)])],64))}},Ee={class:"flex justify-center my-8 py-16"},Re={class:"flex flex-col mx-5"},Ne={class:"text-center text-slate-700 mt-5 text-sm"},Ae={class:"text-center text-slate-700 mt-5 text-sm"},Fe="請輸入您的註冊代碼：",ze="例如：1234567",Ke={__name:"CreateUserVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["state","status"],setup(b,{emit:f}){const s=b,t=f,u=`請於您的電子郵件信箱 ${s.currentMail} 收取註冊代碼。`,a=m(""),c=m(!1),o=m(!1),v=()=>{location.reload()},d=async i=>{var l;const r=U();try{await r.patch("users",{json:{session_id:s.sessionId,code:i}}),o.value=!0,t("status",{message:"註冊成功，正在寫入憑證..."}),H(s.currentMail),B()}catch(x){console.error(x);const V=((l=x==null?void 0:x.response)==null?void 0:l.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${V})`})}},n=async i=>{if(!i){t("status",{message:"請輸入註冊代碼"});return}c.value=!0,await d(i),c.value=!1};return(i,r)=>(p(),k(T,null,[e("div",Ee,[e("div",Re,[e("label",{class:"input-label text-base mb-2"},y(Fe)),j(L,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=l=>a.value=l),"input-description":u,"input-placeholder":ze,"is-load":c.value,"is-done":o.value,onSubmit:n},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:v}," 取消 ")]),e("div",Ne,[e("div",null,"申請時間："+y(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+y(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+y(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+y(s.sessionIp||"未知"),1)]),P(e("div",Ae,[e("div",null,"目標電子郵件地址："+y(s.currentMail||"未知"),1)],512),[[A,s.currentMail]])],64))}},Je={__name:"HomeView",setup(b){const f=m("CreateTokenRequest"),s=m(null),t=m(""),u={CreateTokenRequest:xe,CreateTokenEmpty:Se,CreateTokenVerify:Te,CreateUserRequest:Be,CreateUserVerify:Ke},a=M(()=>u[f.value]),c=({name:v,props:d})=>{f.value=v,s.value=d??{},requestAnimationFrame(()=>{window.scroll({behavior:"smooth",top:0})})},o=({message:v})=>{t.value=v};return(v,d)=>(p(),k(T,null,[(p(),q(se(a.value),ee(s.value,{onState:c,onStatus:o}),null,16)),j(ne,{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=n=>t.value=n)},null,8,["modelValue"])],64))}};export{Je as default};
