import{r as n,u as U,c as i,o as q,a as p,b as m,d as t,t as v,e as x,f as F,g as _,F as L,h as T,i as A,j as W}from"./index-d0a8f5f0.js";import{_ as z}from"./InputModal-38a8e617.js";import{_ as G}from"./ToastModal-cef008e2.js";const J={class:"flex justify-center my-8 py-16"},O={class:"flex flex-col mx-5"},Q={class:"input-label text-base mb-2"},X={key:0,class:"flex justify-center mt-5"},Y={key:1,class:"flex justify-center mt-5"},Z={key:2,class:"text-center text-slate-700 mt-5 text-sm"},g="saraInputHistoryLogin",ee="saraRegisterEmail",le={__name:"HomeView",setup(se){const y=n(!1),b=n(!1),c=n(""),o=n(""),f=n(""),s=n(""),h=n(""),k=n(""),w=n(""),d=n(""),S=W(),C=U(),V=i(()=>s.value?"請輸入您的登入代碼：":"請輸入您的電子郵件地址："),I=i(()=>s.value?"例如：123456":"例如：sara@web-tech.tw"),j=i(()=>s.value?`請於您的電子郵件信箱 ${f.value} 收取登入代碼。`:""),H=i(()=>s.value?"text":"email"),$=i(()=>s.value?"請輸入登入代碼":"請輸入電子郵件地址"),R=i(()=>!s.value),B=i(()=>!s.value&&!!c.value),D=i(()=>!!s.value),E=()=>{o.value="尚未實作"},K=()=>{localStorage.removeItem(g),c.value="",o.value="成功清除登入記錄"},M=async u=>{if(!u){o.value=$.value;return}o.value="",y.value=!0,s.value?await P(u):await N(u),y.value=!1},N=async u=>{var e,a;try{const r=await(await S.post("tokens",{json:{email:u}})).json();r!=null&&r.session_id?(s.value=r.session_id,h.value=r.session_ua,k.value=r.session_ip,w.value=r.session_tm,f.value=d.value,c.value="",d.value=""):o.value="發生錯誤 (無錯誤代碼)"}catch(l){if(((e=l==null?void 0:l.response)==null?void 0:e.status)===404)sessionStorage.setItem(ee,u),C.push("/register");else{const r=((a=l==null?void 0:l.response)==null?void 0:a.status)||"無錯誤代碼";o.value=`發生錯誤 (${r})`,console.error(l.message)}}},P=async u=>{var e;try{await S.patch("tokens",{json:{session_id:s.value,code:u}}),b.value=!0,o.value="登入成功，正在寫入憑證...",localStorage.setItem(g,f.value),T()}catch(a){const l=((e=a==null?void 0:a.response)==null?void 0:e.status)||"無錯誤代碼";o.value=`發生錯誤 (${l})`,console.error(a.message)}};return q(()=>{c.value=localStorage.getItem(g)}),(u,e)=>(p(),m(L,null,[t("div",J,[t("div",O,[t("label",Q,v(V.value),1),x(z,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),loading:y.value,done:b.value,placeholder:I.value,description:j.value,"input-type":H.value,"input-history":c.value,onSubmit:M},null,8,["modelValue","loading","done","placeholder","description","input-type","input-history"])])]),R.value?(p(),m("div",X,[t("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:E},[t("span",null,[x(F(A),{class:"h-5 w-5"})]),e[2]||(e[2]=t("span",{class:"font-bold"}," Passkey ",-1))])])):_("",!0),B.value?(p(),m("div",Y,[t("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:K},e[3]||(e[3]=[t("span",{class:"font-bold"}," 清除登入記錄 ",-1)]))])):_("",!0),D.value?(p(),m("div",Z,[t("div",null,"申請時間："+v(w.value||"未知"),1),t("div",null,"申請識別碼："+v(s.value||"未知"),1),t("div",null,"申請來源裝置："+v(h.value||"未知"),1),t("div",null,"申請來源 IP 位址："+v(k.value||"未知"),1)])):_("",!0),x(G,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a)},null,8,["modelValue"])],64))}};export{le as default};
