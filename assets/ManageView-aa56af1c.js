import{r as m,k as U,c as h,o as B,l as G,a as l,b as n,d as s,m as P,e as r,t as a,w as v,n as E,f as w,p as $,v as F,F as k,q as _,g as K,h as S,s as q}from"./index-806a709b.js";import{b as J,a as W}from"./index-a06124f1.js";import{_ as z,u as Q}from"./ToastModal-d6f426ba.js";const X={class:"flex justify-center my-8 py-16"},Y={key:0,class:"flex flex-col mx-auto"},Z={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},ee={key:0,class:"overflow-hidden shadow-md"},se={class:"p-6 bg-white border-b border-gray-200"},te={class:"p-6"},oe={class:"p-6"},re={class:"p-6 bg-white border-b border-gray-200"},le={class:"flex rounded bg-white"},ne={key:1,class:"overflow-hidden shadow-md"},ae={class:"p-6 bg-white border-b border-gray-200"},de={class:"flex rounded bg-white"},ie={class:"p-6 bg-white border-b border-gray-200"},be={key:2,class:"overflow-hidden shadow-md"},ue={class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"},pe={class:"p-6 bg-white border-b border-gray-200"},me={class:"p-6 bg-white border-b border-gray-200"},ge={class:"text-center text-slate-600"},ce={class:"ml-7"},xe=["onClick"],ye={key:0,class:"p-6 bg-white border-b border-gray-200"},ve={class:"list-disc ml-7"},we={key:1},Se={__name:"ManageView",setup(ke){const{VITE_HOME_INTE_HOST:f,VITE_SARA_TOKEN_NAME:T,VITE_SARA_GUARD_NAME:A}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_RECV_HOST:"https://web-tech.tw/recv/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_SARA_GUARD_NAME:"guard_token",BASE_URL:"/sara/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},i=m(""),c=m(!1),x=m(!1),y=m({confirm:""}),g=m({nickname:""}),t=U({isLoaded:!1,isError:!1}),p=Q(),C=h(()=>Array.isArray(t==null?void 0:t.roles)&&t.roles.length),V=h(()=>J()),N=()=>{localStorage.removeItem(T),localStorage.removeItem(A),location.replace(f)},D=()=>{c.value=!0},I=()=>{c.value=!1},R=async()=>{if(y.value.confirm!=="DELETE"){i.value="請輸入 DELETE 以確認刪除";return}await p.delete("users/me"),i.value="刪除成功",setTimeout(()=>{location.replace(f)},1300)},O=()=>{x.value=!0},M=()=>{x.value=!1},L=async()=>{await p.put("users/me",{json:{nickname:g.value.nickname}}),i.value="修改成功",setTimeout(()=>{location.reload()},1300)},H=b=>{i.value=`尚未實作：管理通行金鑰 ${b.name}`},j=async()=>{const b=await p.post("users/me/passkeys"),{session_id:e,session_options:u}=await b.json();let o;try{o=await W({optionsJSON:u})}catch(d){console.error(d),i.value=d.message;return}try{await p.patch("users/me/passkeys",{json:{session_id:e,credential:o}}),setTimeout(()=>{location.reload()},1300)}catch(d){console.error(d),i.value=d.message;return}};return B(async()=>{try{const e=await(await p.get("users/me")).json(),{profile:u}=e;Object.assign(t,u),t.isLoaded=!0;const{nickname:o}=u;g.value.nickname=o}catch(b){console.warn(b.message)}}),(b,e)=>{const u=G("router-link");return l(),n(k,null,[s("div",X,[t.isLoaded?(l(),n("div",Y,[s("div",Z,[c.value?(l(),n("div",ee,[e[16]||(e[16]=P('<div class="px-6 py-4 bg-white border-b border-gray-200 font-bold"> 刪除帳號 </div><div class="p-6 bg-white border-b border-gray-200 text-red-600"> ⚠️ 請注意，刪除帳號後，所有資料將無法復原。 </div><div class="p-6 bg-white border-b border-gray-200"><p class="text-amber-500"> ‼️ 刪除並非完全抹除 ‼️ </p> 本系統將保留您的「Sara 系統使用者識別碼」以供您先前曾使用的服務繼續應用，但會將您的暱稱及電子郵件地址設為無效值。<br> 這意味著，您將 <span class="text-red-600">永久喪失</span> 本帳號的存取權限，您將不再被識別為「同一個使用者」。但您的互動紀錄仍會保留在系統中作為服務參照。 <div class="my-3"> 以下是將被刪除的資料： <ul class="list-disc ml-6"><li>暱稱</li><li>電子郵件地址</li><li>您對本「Sara 系統使用者識別碼」之存取權限</li></ul></div> 在帳號刪除後，您將無法再次使用此帳號登入本系統。<br> 但您可使用相同的電子郵件地址重新註冊新帳號。 </div><div class="p-6 bg-white border-b border-gray-200 text-red-600"> 請注意，刪除帳號後，所有資料將無法復原。<br> 本操作無法撤銷，請謹慎考慮。<br> 若確定刪除，請輸入 DELETE 以確認。 </div>',4)),s("div",se,[e[13]||(e[13]=r(" 將被刪除的帳號資訊如下： ")),s("div",te,[e[3]||(e[3]=s("span",{class:"text-gray-600"},"暱稱：",-1)),r(a(t.nickname),1),e[4]||(e[4]=s("br",null,null,-1)),e[5]||(e[5]=s("span",{class:"text-gray-600"},"電子郵件地址：",-1)),r(a(t.email),1),e[6]||(e[6]=s("br",null,null,-1)),e[7]||(e[7]=s("span",{class:"text-red-600"},"（資料將會立即抹除，不會保存您的資訊）",-1))]),e[14]||(e[14]=r(" 將解除存取權限的使用者識別碼如下： ")),s("div",oe,[e[8]||(e[8]=s("span",{class:"text-gray-600"},"Sara 系統使用者識別碼：",-1)),r(a(t._id),1),e[9]||(e[9]=s("br",null,null,-1)),e[10]||(e[10]=s("span",{class:"text-gray-600"},"Sara 系統權限烙印：",-1)),r(a(t.roles.length)+" 組",1),e[11]||(e[11]=s("br",null,null,-1)),e[12]||(e[12]=s("span",{class:"text-red-600"},"（資料仍會保留在系統中，但將無法再次使用）",-1))])]),s("div",re,[s("div",le,[e[15]||(e[15]=s("label",{class:"w-16 py-1 text-gray-600",for:"confirm"}," 刪除： ",-1)),v(s("input",{id:"confirm","onUpdate:modelValue":e[0]||(e[0]=o=>y.value.confirm=o),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none rounded focus:ring",placeholder:"若確定刪除，請輸入 DELETE",type:"text"},null,512),[[E,y.value.confirm]])])]),s("div",{class:"p-6 bg-white border-gray-200 text-right"},[s("button",{class:"bg-red-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-red-600 rounded mr-3",onClick:R}," 確定刪除 "),s("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:I}," 取消 ")])])):x.value?(l(),n("div",ne,[e[21]||(e[21]=s("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 修改個人資料： ",-1)),s("div",ae,[s("div",de,[e[17]||(e[17]=s("label",{class:"w-16 py-1 text-gray-600",for:"nickname"}," 暱稱： ",-1)),v(s("input",{id:"nickname","onUpdate:modelValue":e[1]||(e[1]=o=>g.value.nickname=o),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none rounded focus:ring",placeholder:"星川 サラ",type:"text"},null,512),[[E,g.value.nickname]])])]),s("div",ie,[e[19]||(e[19]=r(" 若要修改電子郵件地址，請點 ")),w(u,{class:"text-sky-500 hover:text-sky-700",to:"/manage/email"},{default:$(()=>e[18]||(e[18]=[r(" 此處 ")])),_:1}),e[20]||(e[20]=r(" 。 "))]),s("div",{class:"p-6 bg-white border-gray-200 text-right"},[s("button",{class:"bg-sky-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-sky-600 rounded mr-3",onClick:L}," 確定修改 "),s("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:M}," 取消 ")])])):(l(),n("div",be,[s("div",ue," 您好，"+a(t.nickname)+"，這裡是您的個人資料： ",1),s("div",pe,[e[22]||(e[22]=s("span",{class:"text-gray-600"},"暱稱：",-1)),r(a(t.nickname),1),e[23]||(e[23]=s("br",null,null,-1)),e[24]||(e[24]=s("span",{class:"text-gray-600"},"電子郵件地址：",-1)),r(a(t.email),1),e[25]||(e[25]=s("br",null,null,-1)),e[26]||(e[26]=s("span",{class:"text-gray-600"},"Sara 系統使用者識別碼：",-1)),r(a(t._id),1)]),s("div",{class:"p-6 bg-white border-b border-gray-200 text-right"},[s("button",{class:"bg-amber-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-amber-600 rounded mr-3",onClick:N}," 登出 "),s("button",{class:"bg-red-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-red-600 rounded mr-3",onClick:D}," 刪除帳號 "),s("button",{class:"bg-sky-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-sky-600 rounded",onClick:O}," 修改個人資料 ")]),s("div",me,[e[28]||(e[28]=s("span",{class:"text-gray-600"},"通行金鑰：",-1)),v(s("div",ge," 尚未設定通行金鑰 ",512),[[F,!t.passkeys.length]]),s("ul",ce,[(l(!0),n(k,null,_(t.passkeys,(o,d)=>(l(),n("li",{key:d},[s("button",{class:"w-full bg-white shadow-md text-sm text-slate-700 font-bold py-3 md:px-8 px-4 my-3 hover:bg-slate-300 rounded",onClick:fe=>H(o)},a(o.name),9,xe)]))),128))]),V.value?(l(),n("button",{key:0,class:"w-full bg-white shadow-md text-sm text-slate-700 font-bold py-3 md:px-8 px-4 my-3 hover:bg-slate-300 rounded",onClick:j},[w(K(q),{class:"w-6 h-6 inline-block -mt-1 mr-2"}),e[27]||(e[27]=r(" 新增通行金鑰 "))])):S("",!0)]),C.value?(l(),n("div",ye,[e[29]||(e[29]=s("span",{class:"text-gray-600"},"持有權限烙印：",-1)),s("ul",ve,[(l(!0),n(k,null,_(t.roles,(o,d)=>(l(),n("li",{key:d},a(o),1))),128))])])):S("",!0)]))])])):(l(),n("div",we,a(t.isError?"發生錯誤":"載入中..."),1))]),w(z,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value=o)},null,8,["modelValue"])],64)}}};export{Se as default};
