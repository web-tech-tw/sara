import{r as i,u as B,c as u,o as M,a as h,b,d as l,t as c,e as w,g as N,F as U,h as D,j as F}from"./index-747f06ef.js";import{_ as T}from"./InputModal-18f7b50f.js";import{_ as A}from"./ToastModal-ef59fa23.js";const K={class:"flex justify-center my-8 py-16"},L={class:"flex flex-col mx-5"},P={class:"input-label text-base mb-2"},W={key:0,class:"text-center text-slate-700 mt-5 text-sm"},p="saraRegisterEmail",O={__name:"RegisterView",props:{email:{type:String,required:!0}},setup(z){const m=i(!1),n=i(""),g=i(""),s=i(""),f=i(""),_=i(""),y=i(""),d=i(""),v=B(),x=F(),V=u(()=>s.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),S=u(()=>s.value?"例如：1234567":"例如：星川 サラ"),k=u(()=>s.value?`請於您的電子郵件信箱 ${g.value} 收取註冊代碼。`:""),C=u(()=>s.value?"text":"email"),j=u(()=>s.value?"請輸入註冊代碼":"請輸入暱稱"),E=u(()=>!!s.value),I=()=>{window.history.length?v.back():v.replace("/")},R=async t=>{if(!t){n.value=j.value;return}n.value="",m.value=!0,s.value?await q(t):await $(t),m.value=!1},$=async t=>{var e;const a=sessionStorage.getItem(p);try{const o=await(await x.post("users",{json:{email:a,nickname:t}})).json();o!=null&&o.session_id?(s.value=o.session_id,f.value=o.session_ua,_.value=o.session_ip,y.value=o.session_tm,g.value=d.value,d.value=""):n.value="發生錯誤 (無錯誤代碼)"}catch(r){const o=((e=r==null?void 0:r.response)==null?void 0:e.status)||"無錯誤代碼";n.value=`發生錯誤 (${o})`,console.error(r.message)}},q=async t=>{var a;try{await x.patch("users",{json:{session_id:s.value,code:t}}),n.value="註冊成功，正在寫入憑證...",sessionStorage.removeItem(p),D()}catch(e){const r=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";n.value=`發生錯誤 (${r})`,console.error(e.message)}};return M(()=>{sessionStorage.getItem(p)||v.replace("/")}),(t,a)=>(h(),b(U,null,[l("div",K,[l("div",L,[l("label",P,c(V.value),1),w(T,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),loading:m.value,placeholder:S.value,description:k.value,"input-type":C.value,onSubmit:R},null,8,["modelValue","loading","placeholder","description","input-type"])])]),l("div",{class:"flex justify-center mt-5"},[l("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:I}," 取消 ")]),E.value?(h(),b("div",W,[l("div",null,"申請時間："+c(y.value||"未知"),1),l("div",null,"申請識別碼："+c(s.value||"未知"),1),l("div",null,"申請來源裝置："+c(f.value||"未知"),1),l("div",null,"申請來源 IP 位址："+c(_.value||"未知"),1)])):N("",!0),w(A,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e)},null,8,["modelValue"])],64))}};export{O as default};
