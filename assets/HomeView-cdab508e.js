import{r as n,u as U,c as r,o as q,a as m,b as p,d as t,t as v,e as x,f as F,g,F as L,h as T,i as A,j as W}from"./index-2b376515.js";import{_ as z}from"./InputModal-7b012e06.js";import{_ as G}from"./ToastModal-82022abf.js";const J={class:"flex justify-center my-8 py-16"},O={class:"flex flex-col mx-5"},Q={class:"input-label text-base mb-2"},X={key:0,class:"flex justify-center mt-5"},Y={key:1,class:"flex justify-center mt-5"},Z={key:2,class:"text-center text-slate-700 mt-5 text-sm"},_="saraLoginEmailHistory",ee="saraRegisterEmail",le={__name:"HomeView",setup(se){const y=n(!1),b=n(!1),c=n(""),o=n(""),f=n(""),s=n(""),h=n(""),k=n(""),w=n(""),d=n(""),S=W(),C=U(),V=r(()=>s.value?"請輸入您的登入代碼：":"請輸入您的電子郵件地址："),j=r(()=>s.value?"例如：123456":"例如：sara@web-tech.tw"),I=r(()=>s.value?`請於您的電子郵件信箱 ${f.value} 收取登入代碼。`:""),H=r(()=>s.value?"text":"email"),E=r(()=>s.value?"請輸入登入代碼":"請輸入電子郵件地址"),$=r(()=>!s.value),R=r(()=>!s.value&&!!c.value),B=r(()=>!!s.value),D=()=>{o.value="尚未實作"},K=()=>{localStorage.removeItem(_),c.value="",o.value="成功清除登入記錄"},M=async u=>{if(!u){o.value=E.value;return}o.value="",y.value=!0,s.value?await P(u):await N(u),y.value=!1},N=async u=>{var e,a;try{const i=await(await S.post("tokens",{json:{email:u}})).json();i!=null&&i.session_id?(s.value=i.session_id,h.value=i.session_ua,k.value=i.session_ip,w.value=i.session_tm,f.value=d.value,c.value="",d.value=""):o.value="發生錯誤 (無錯誤代碼)"}catch(l){if(((e=l==null?void 0:l.response)==null?void 0:e.status)===404)sessionStorage.setItem(ee,u),C.push("/register");else{const i=((a=l==null?void 0:l.response)==null?void 0:a.status)||"無錯誤代碼";o.value=`發生錯誤 (${i})`,console.error(l.message)}}},P=async u=>{var e;try{await S.patch("tokens",{json:{session_id:s.value,code:u}}),b.value=!0,o.value="登入成功，正在寫入憑證...",localStorage.setItem(_,f.value),T()}catch(a){const l=((e=a==null?void 0:a.response)==null?void 0:e.status)||"無錯誤代碼";o.value=`發生錯誤 (${l})`,console.error(a.message)}};return q(()=>{c.value=localStorage.getItem(_)}),(u,e)=>(m(),p(L,null,[t("div",J,[t("div",O,[t("label",Q,v(V.value),1),x(z,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),loading:y.value,done:b.value,placeholder:j.value,description:I.value,"input-type":H.value,"input-history":c.value,onSubmit:M},null,8,["modelValue","loading","done","placeholder","description","input-type","input-history"])])]),$.value?(m(),p("div",X,[t("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:D},[t("span",null,[x(F(A),{class:"h-5 w-5"})]),e[2]||(e[2]=t("span",{class:"font-bold"}," Passkey ",-1))])])):g("",!0),R.value?(m(),p("div",Y,[t("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:K},e[3]||(e[3]=[t("span",{class:"font-bold"}," 清除登入記錄 ",-1)]))])):g("",!0),B.value?(m(),p("div",Z,[t("div",null,"申請時間："+v(w.value||"未知"),1),t("div",null,"申請識別碼："+v(s.value||"未知"),1),t("div",null,"申請來源裝置："+v(h.value||"未知"),1),t("div",null,"申請來源 IP 位址："+v(k.value||"未知"),1)])):g("",!0),x(G,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a)},null,8,["modelValue"])],64))}};export{le as default};
