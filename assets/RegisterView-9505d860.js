import{r,d as V,e as m,i as S,j,o as k,c as C,b as i,t as E,f as g,F as I,g as R,h as $}from"./index-f69b8280.js";import{_ as q}from"./InputModal-3661dfb3.js";const B={class:"flex justify-center my-8 py-16"},M={class:"flex flex-col mx-5"},F={class:"input-label text-base mb-2"},D={__name:"RegisterView",props:{email:{type:String,required:!0}},setup(N){const u=r(!1),o=r(""),p=r(""),l=r(""),c=r(""),d=V(),v=$(),_=m(()=>l.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),f=m(()=>l.value?"例如：1234567":"例如：星川 サラ"),y=m(()=>l.value?`請於您的電子郵件信箱 ${p.value} 收取註冊代碼。`:""),b=()=>{window.history.length?d.back():d.replace("/")},x=async s=>{if(!s){o.value="請輸入資料";return}o.value="",u.value=!0,l.value?await w(s):await h(s),u.value=!1},h=async s=>{var a;const t=sessionStorage.getItem("sara_register_email");try{const n=await(await v.post("users",{json:{email:t,nickname:s}})).json();n!=null&&n.session_id?(l.value=n.session_id,p.value=c.value,c.value=""):o.value="發生錯誤 (無錯誤代碼)"}catch(e){const n=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";o.value=`發生錯誤 (${n})`,console.error(e.message)}},w=async s=>{var t;try{await v.patch("users",{json:{session_id:l.value,code:s}}),o.value="註冊成功，正在寫入憑證...",sessionStorage.removeItem("sara_register_email"),R()}catch(a){const e=((t=a==null?void 0:a.response)==null?void 0:t.status)||"無錯誤代碼";o.value=`發生錯誤 (${e})`,console.error(a.message)}};return S(()=>{sessionStorage.getItem("sara_register_email")||d.replace("/")}),(s,t)=>{const a=j("toast-modal");return k(),C(I,null,[i("div",B,[i("div",M,[i("label",F,E(_.value),1),g(q,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),loading:u.value,placeholder:f.value,description:y.value,onSubmit:x},null,8,["modelValue","loading","placeholder","description"])])]),i("div",{class:"flex justify-center mt-5"},[i("button",{class:"bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:b}," 取消 ")]),g(a,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e)},null,8,["modelValue"])],64)}}};export{D as default};
