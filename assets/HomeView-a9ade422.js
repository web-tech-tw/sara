import{o as u,c as _,a as e,n as z,m as E,u as K,r as y,b as V,d as R,e as O,w as D,v as Z,f as J,g as q,h as L,i as I,j as N,t as f,k as W,l as U,p as G,q as Q,F as T,s as X,x as H,y as B,z as S,A as Y,B as ee}from"./index-45c5ff98.js";import{b as se,s as te,u as j,_ as oe}from"./ToastModal-a32ea02b.js";const A={__name:"LoadingCircleIcon",props:{class:{type:String,required:!1,default:()=>""}},setup(v){const d=v;return(s,t)=>(u(),_("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:z(d.class)},t[0]||(t[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M 3 11.958 C 3.205 6.522 7.226 2.994 11.995 2.993 L 11.954 1.007 C 5.327 1.007 1.002 5.322 1.002 11.949 L 3 11.958 Z M 5.285 17.992 C 3.993 16.533 2.997 13.906 3 11.957 L 1 11.948 C 1 14.99 1.927 17.208 3.792 19.322 L 5.285 17.992 Z"},null,-1)]),2))}};function ne(v,d){return u(),_("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function ae(v,d){return u(),_("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}const ie={class:"input-modal"},re={class:"flex rounded bg-white w-auto h-16 shadow-md md:w-[30rem]"},le=["placeholder","type","disabled"],ue=["disabled"],ce=["disabled"],de={class:"text-base mt-2"},P={__name:"InputModal",props:E({inputPlaceholder:{type:String,required:!1,default:()=>""},inputDescription:{type:String,required:!1,default:()=>""},inputType:{type:String,required:!1,default:()=>"text"},inputHistory:{type:String,required:!1,default:()=>""},isLoad:{type:Boolean,required:!1,default:()=>!0},isDone:{type:Boolean,required:!1,default:()=>!1},noSubmit:{type:Boolean,required:!1,default:()=>!1}},{modelValue:{type:String},modelModifiers:{}}),emits:E(["submit"],["update:modelValue"]),setup(v,{emit:d}){const s=v,t=K(v,"modelValue"),c=d,a=y(!1),p=V(()=>!!s.inputHistory&&!t.value&&a.value),o=V(()=>s.isLoad||s.isDone),x=()=>{t.value=s.inputHistory,a.value=!1},m=()=>{a.value=!0},n=l=>{document.querySelector(".input-modal").contains(l.target)||(a.value=!1)},i=()=>{c("submit",t.value)};return R(()=>{document.addEventListener("click",n)}),O(()=>{document.removeEventListener("click",n)}),(l,r)=>(u(),_("div",ie,[e("div",re,[D(e("input",{"onUpdate:modelValue":r[0]||(r[0]=b=>t.value=b),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none focus:outline-none",placeholder:s.inputPlaceholder,type:s.inputType,disabled:o.value,onFocus:m,onKeydown:J(i,["enter"])},null,40,le),[[Z,t.value]]),s.noSubmit?I("",!0):(u(),_("button",{key:0,class:"m-2 rounded px-4 py-2 font-semibold",disabled:o.value,onClick:i},[s.isDone?(u(),q(L(ae),{key:0,class:"h-6 w-6 my-1"})):s.isLoad?(u(),q(A,{key:1,class:"h-6 w-6 my-1 animate-spin"})):(u(),q(L(ne),{key:2,class:"h-6 w-6 my-1"}))],8,ue))]),D(e("button",{class:"w-[90%] mx-auto flex items-center space-x-2 bg-white-500 shadow-md text-md text-slate-700 font-normal py-3 md:px-8 px-4 hover:bg-slate-100 rounded mt-1 animate-fade",disabled:o.value,onClick:x},f(s.inputHistory),9,ce),[[N,p.value]]),e("p",de,f(s.description),1)]))}},pe={class:"flex justify-center my-8 py-16"},me={class:"flex flex-col mx-5"},ye={key:0,class:"flex justify-center mt-5"},fe={key:1,class:"flex justify-center mt-5"},ve="請輸入您的電子郵件地址：",xe="例如：sara@web-tech.tw",be="email",he={__name:"CreateTokenRequest",emits:["state","status"],setup(v,{emit:d}){const s=y(""),t=y(""),c=y(!1),a=y(!1),p=y(!1),o=y(!1),x=V(()=>se()&&!o.value),m=V(()=>!!t.value),n=d,i=async()=>{const{value:h}=s;if(!h){n("status",{message:"請輸入電子郵件地址"});return}c.value=!0,await r(h),c.value=!1},l=()=>{X(),t.value="",n("status",{message:"成功清除登入記錄"})},r=async h=>{var $;const w=j();try{p.value=!0;const C=await w.post("tokens/passkeys",{json:{email:h}}),{session_id:g,session_options:k}=await C.json(),F=await te({optionsJSON:k});await w.patch("tokens/passkeys",{json:{session_id:g,credential:F}}),a.value=!0,n("status",{message:"登入成功，正在寫入憑證..."}),H(h),B()}catch(C){console.error(C);const g=(($=C==null?void 0:C.response)==null?void 0:$.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${g})`}),p.value=!1}},b=async h=>{var $,C;const w=j();try{o.value=!0;const k=await(await w.post("tokens",{json:{email:h}})).json();if(!(k!=null&&k.session_id)){n("status",{message:"發生錯誤 (無錯誤代碼)"});return}n("state",{name:"CreateTokenVerify",props:{sessionId:k.session_id,sessionTm:k.session_tm,sessionUa:k.session_ua,sessionIp:k.session_ip,currentMail:h}})}catch(g){if((($=g==null?void 0:g.response)==null?void 0:$.status)===404){n("state",{name:"CreateTokenEmpty",props:{currentMail:h}});return}console.error(g);const k=((C=g==null?void 0:g.response)==null?void 0:C.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${k})`}),o.value=!1}},M=async h=>{if(!h){n("status",{message:"請輸入電子郵件地址"});return}c.value=!0,await b(h),c.value=!1};return R(()=>{t.value=W()}),(h,w)=>(u(),_(T,null,[e("div",pe,[e("div",me,[e("label",{class:"input-label text-base mb-2"},f(ve)),U(P,{modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=$=>s.value=$),"input-placeholder":xe,"input-type":be,"input-history":t.value,"is-load":c.value,"is-done":a.value,"no-submit":p.value,onSubmit:M},null,8,["modelValue","input-history","is-load","is-done","no-submit"])])]),x.value?(u(),_("div",ye,[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:i},[e("span",null,[a.value?(u(),q(L(G),{key:0,class:"h-5 w-5"})):I("",!0),c.value?(u(),q(A,{key:1,class:"h-5 w-5 animate-spin"})):(u(),q(L(Q),{key:2,class:"h-5 w-5"}))]),w[1]||(w[1]=e("span",{class:"font-bold"}," Passkey ",-1))])])):I("",!0),m.value?(u(),_("div",fe,[e("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:l},w[2]||(w[2]=[e("span",{class:"font-bold"}," 清除登入記錄 ",-1)]))])):I("",!0)],64))}},_e={class:"flex justify-center my-8 py-16"},ge={class:"flex flex-col mx-auto"},we={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},ke={class:"overflow-hidden shadow-md"},Ce={class:"p-6 bg-white border-b border-gray-200"},Se={class:"text-slate-900 my-3"},$e={__name:"CreateTokenEmpty",props:{currentMail:{type:String,required:!0}},emits:["state"],setup(v,{emit:d}){const s=v,t=d,c=()=>{t("state",{name:"CreateUserRequest",props:{currentMail:s.currentMail}})},a=()=>{location.reload()};return(p,o)=>(u(),_("div",_e,[e("div",ge,[e("div",we,[e("div",ke,[o[2]||(o[2]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 尚未註冊 ",-1)),e("div",Ce,[o[0]||(o[0]=S(" 您好，您輸入的電子郵件地址： ")),e("div",Se,f(s.currentMail),1),o[1]||(o[1]=S(" 尚未於 Sara 系統註冊帳號。 "))]),o[3]||(o[3]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您確定曾經註冊過："),e("br"),S(" 請檢查您輸入的電子郵件地址，"),e("br"),S(" 並點選「取消」以重新輸入。 ")],-1)),o[4]||(o[4]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您未曾註冊："),e("br"),S(" 請點選「註冊」以進行註冊。"),e("br"),S(" 註冊即代表您同意我們的 "),e("a",{href:"https://web-tech.tw/#/privacy",class:"text-sky-500 hover:text-sky-700",target:"_blank"}," 隱私權政策 "),S("。 ")],-1)),e("div",{class:"p-6 bg-white border-b border-gray-200 text-right"},[e("button",{class:"bg-amber-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-amber-600 rounded mr-3",onClick:c}," 註冊 "),e("button",{class:"bg-white shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:a}," 取消 ")])])])])]))}},qe={class:"flex justify-center my-8 py-16"},Me={class:"flex flex-col mx-5"},Ve={class:"text-center text-slate-700 mt-5 text-sm"},je={class:"text-center text-slate-700 mt-5 text-sm"},Ue="請輸入您的登入代碼：",Te="例如：123456",Ie={__name:"CreateTokenVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["status"],setup(v,{emit:d}){const s=v,t=d,c=`請於您的電子郵件信箱 ${s.currentMail} 收取登入代碼。`,a=y(""),p=y(!1),o=y(!1),x=()=>{location.reload()},m=async i=>{var r;const l=j();try{await l.patch("tokens",{json:{session_id:s.sessionId,code:i}}),o.value=!0,t("status",{message:"登入成功，正在寫入憑證..."}),H(s.currentMail),B()}catch(b){console.error(b);const M=((r=b==null?void 0:b.response)==null?void 0:r.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${M})`})}},n=async i=>{if(!i){t("status",{message:"請輸入登入代碼"});return}p.value=!0,await m(i),p.value=!1};return(i,l)=>(u(),_(T,null,[e("div",qe,[e("div",Me,[e("label",{class:"input-label text-base mb-2"},f(Ue)),U(P,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=r=>a.value=r),"input-description":c,"input-placeholder":Te,"is-load":p.value,"is-done":o.value,onSubmit:n},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:x}," 取消 ")]),e("div",Ve,[e("div",null,"申請時間："+f(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+f(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+f(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+f(s.sessionIp||"未知"),1)]),e("div",je,[e("div",null,"目標電子郵件地址："+f(s.currentMail||"未知"),1)])],64))}},Le={class:"flex justify-center my-8 py-16"},Pe={class:"flex flex-col mx-5"},De={class:"text-center text-slate-700 mt-5 text-sm"},He="請輸入您的暱稱：",Be="例如：星川 サラ",Ee={__name:"CreateUserRequest",props:{currentMail:{type:String,required:!0}},emits:["state","status"],setup(v,{emit:d}){const s=v,t=d,c=y(""),a=y(!1),p=()=>{location.reload()},o=async m=>{var i;const n=j();try{const r=await(await n.post("users",{json:{email:s.currentMail,nickname:m}})).json();t("state",{name:"CreateUserVerify",props:{sessionId:r.session_id,sessionTm:r.session_tm,sessionUa:r.session_ua,sessionIp:r.session_ip,currentMail:s.currentMail}})}catch(l){console.error(l);const r=((i=l==null?void 0:l.response)==null?void 0:i.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${r})`})}},x=async m=>{if(!m){t("status",{message:"請輸入暱稱"});return}a.value=!0,await o(m),a.value=!1};return(m,n)=>(u(),_(T,null,[e("div",Le,[e("div",Pe,[e("label",{class:"input-label text-base mb-2"},f(He)),U(P,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=i=>c.value=i),"input-placeholder":Be,"is-load":a.value,onSubmit:x},null,8,["modelValue","is-load"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:p}," 取消 ")]),e("div",De,[e("div",null,"目標電子郵件地址："+f(s.currentMail||"未知"),1)])],64))}},Re={class:"flex justify-center my-8 py-16"},Ne={class:"flex flex-col mx-5"},Ae={class:"text-center text-slate-700 mt-5 text-sm"},Fe={class:"text-center text-slate-700 mt-5 text-sm"},ze="請輸入您的註冊代碼：",Ke="例如：1234567",Oe={__name:"CreateUserVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["state","status"],setup(v,{emit:d}){const s=v,t=d,c=`請於您的電子郵件信箱 ${s.currentMail} 收取註冊代碼。`,a=y(""),p=y(!1),o=y(!1),x=()=>{location.reload()},m=async i=>{var r;const l=j();try{await l.patch("users",{json:{session_id:s.sessionId,code:i}}),o.value=!0,t("status",{message:"註冊成功，正在寫入憑證..."}),H(s.currentMail),B()}catch(b){console.error(b);const M=((r=b==null?void 0:b.response)==null?void 0:r.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${M})`})}},n=async i=>{if(!i){t("status",{message:"請輸入註冊代碼"});return}p.value=!0,await m(i),p.value=!1};return(i,l)=>(u(),_(T,null,[e("div",Re,[e("div",Ne,[e("label",{class:"input-label text-base mb-2"},f(ze)),U(P,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=r=>a.value=r),"input-description":c,"input-placeholder":Ke,"is-load":p.value,"is-done":o.value,onSubmit:n},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:x}," 取消 ")]),e("div",Ae,[e("div",null,"申請時間："+f(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+f(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+f(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+f(s.sessionIp||"未知"),1)]),D(e("div",Fe,[e("div",null,"目標電子郵件地址："+f(s.currentMail||"未知"),1)],512),[[N,s.currentMail]])],64))}},We={__name:"HomeView",setup(v){const d=y("CreateTokenRequest"),s=y(null),t=y(""),c={CreateTokenRequest:he,CreateTokenEmpty:$e,CreateTokenVerify:Ie,CreateUserRequest:Ee,CreateUserVerify:Oe},a=V(()=>c[d.value]),p=({name:x,props:m})=>{d.value=x,s.value=m??{},requestAnimationFrame(()=>{window.scroll({behavior:"smooth",top:0})})},o=({message:x})=>{t.value=x};return(x,m)=>(u(),_(T,null,[(u(),q(ee(a.value),Y(s.value,{onState:p,onStatus:o}),null,16)),U(oe,{modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=n=>t.value=n)},null,8,["modelValue"])],64))}};export{We as default};
