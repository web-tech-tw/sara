import{r as l,u as B,c as r,o as M,a as g,b as h,d as t,t as c,f as w,h as N,w as U,v as q,F,i as H,k as K}from"./index-0d3eb3fb.js";import{_ as L}from"./InputModal-a13bf7b7.js";import{_ as T}from"./ToastModal-ea3c38c1.js";const A={class:"flex justify-center my-8 py-16"},P={class:"flex flex-col mx-5"},W={class:"input-label text-base mb-2"},z={key:0,class:"text-center text-slate-700 mt-5 text-sm"},G={class:"text-center text-slate-700 mt-5 text-sm"},J="saraLoginEmailHistory",b="saraRegisterEmail",Z={__name:"RegisterView",setup(O){const v=l(!1),p=l(!1),n=l(""),u=l(""),a=l(""),f=l(""),_=l(""),x=l(""),d=l(""),m=B(),y=K(),V=r(()=>a.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),k=r(()=>a.value?"例如：1234567":"例如：星川 サラ"),S=r(()=>a.value?`請於您的電子郵件信箱 ${u.value} 收取註冊代碼。`:""),C=r(()=>a.value?"text":"email"),I=r(()=>a.value?"請輸入註冊代碼":"請輸入暱稱"),j=r(()=>!!a.value),E=()=>{window.history.length?m.back():m.replace("/")},R=async i=>{if(!i){n.value=I.value;return}n.value="",v.value=!0,a.value?await D(i):await $(i),v.value=!1},$=async i=>{var o;try{const s=await(await y.post("users",{json:{email:u.value,nickname:i}})).json();s!=null&&s.session_id?(a.value=s.session_id,f.value=s.session_ua,_.value=s.session_ip,x.value=s.session_tm,d.value=""):n.value="發生錯誤 (無錯誤代碼)"}catch(e){const s=((o=e==null?void 0:e.response)==null?void 0:o.status)||"無錯誤代碼";n.value=`發生錯誤 (${s})`,console.error(e.message)}},D=async i=>{var o;try{await y.patch("users",{json:{session_id:a.value,code:i}}),p.value=!0,n.value="註冊成功，正在寫入憑證...",sessionStorage.removeItem(b),localStorage.setItem(J,u.value),H()}catch(e){const s=((o=e==null?void 0:e.response)==null?void 0:o.status)||"無錯誤代碼";n.value=`發生錯誤 (${s})`,console.error(e.message)}};return M(()=>{u.value=sessionStorage.getItem(b),u.value||m.replace("/")}),(i,o)=>(g(),h(F,null,[t("div",A,[t("div",P,[t("label",W,c(V.value),1),w(L,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=e=>d.value=e),loading:v.value,done:p.value,placeholder:k.value,description:S.value,"input-type":C.value,onSubmit:R},null,8,["modelValue","loading","done","placeholder","description","input-type"])])]),t("div",{class:"flex justify-center mt-5"},[t("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:E}," 取消 ")]),j.value?(g(),h("div",z,[t("div",null,"申請時間："+c(x.value||"未知"),1),t("div",null,"申請識別碼："+c(a.value||"未知"),1),t("div",null,"申請來源裝置："+c(f.value||"未知"),1),t("div",null,"申請來源 IP 位址："+c(_.value||"未知"),1)])):N("",!0),U(t("div",G,[t("div",null,"目標電子郵件地址："+c(u.value||"未知"),1)],512),[[q,u.value]]),w(T,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value=e)},null,8,["modelValue"])],64))}};export{Z as default};
