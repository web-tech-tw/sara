import{r as l,u as D,c as u,o as M,a as b,b as w,d as n,t as c,e as S,g as N,F as U,h as F,j as H}from"./index-2b376515.js";import{_ as K}from"./InputModal-7b012e06.js";import{_ as L}from"./ToastModal-82022abf.js";const T={class:"flex justify-center my-8 py-16"},A={class:"flex flex-col mx-5"},P={class:"input-label text-base mb-2"},W={key:0,class:"text-center text-slate-700 mt-5 text-sm"},z="saraLoginEmailHistory",g="saraRegisterEmail",X={__name:"RegisterView",props:{email:{type:String,required:!0}},setup(G){const m=l(!1),f=l(!1),i=l(""),d=l(""),s=l(""),_=l(""),y=l(""),x=l(""),v=l(""),p=D(),h=H(),V=u(()=>s.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),k=u(()=>s.value?"例如：1234567":"例如：星川 サラ"),E=u(()=>s.value?`請於您的電子郵件信箱 ${d.value} 收取註冊代碼。`:""),C=u(()=>s.value?"text":"email"),I=u(()=>s.value?"請輸入註冊代碼":"請輸入暱稱"),j=u(()=>!!s.value),R=()=>{window.history.length?p.back():p.replace("/")},$=async a=>{if(!a){i.value=I.value;return}i.value="",m.value=!0,s.value?await B(a):await q(a),m.value=!1},q=async a=>{var e;const t=sessionStorage.getItem(g);try{const o=await(await h.post("users",{json:{email:t,nickname:a}})).json();o!=null&&o.session_id?(s.value=o.session_id,_.value=o.session_ua,y.value=o.session_ip,x.value=o.session_tm,d.value=t,v.value=""):i.value="發生錯誤 (無錯誤代碼)"}catch(r){const o=((e=r==null?void 0:r.response)==null?void 0:e.status)||"無錯誤代碼";i.value=`發生錯誤 (${o})`,console.error(r.message)}},B=async a=>{var t;try{await h.patch("users",{json:{session_id:s.value,code:a}}),f.value=!0,i.value="註冊成功，正在寫入憑證...",sessionStorage.removeItem(g),localStorage.setItem(z,d.value),F()}catch(e){const r=((t=e==null?void 0:e.response)==null?void 0:t.status)||"無錯誤代碼";i.value=`發生錯誤 (${r})`,console.error(e.message)}};return M(()=>{sessionStorage.getItem(g)||p.replace("/")}),(a,t)=>(b(),w(U,null,[n("div",T,[n("div",A,[n("label",P,c(V.value),1),S(K,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),loading:m.value,done:f.value,placeholder:k.value,description:E.value,"input-type":C.value,onSubmit:$},null,8,["modelValue","loading","done","placeholder","description","input-type"])])]),n("div",{class:"flex justify-center mt-5"},[n("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:R}," 取消 ")]),j.value?(b(),w("div",W,[n("div",null,"申請時間："+c(x.value||"未知"),1),n("div",null,"申請識別碼："+c(s.value||"未知"),1),n("div",null,"申請來源裝置："+c(_.value||"未知"),1),n("div",null,"申請來源 IP 位址："+c(y.value||"未知"),1)])):N("",!0),S(L,{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e)},null,8,["modelValue"])],64))}};export{X as default};
