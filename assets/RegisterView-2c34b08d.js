import{r as n,u as D,c as u,o as M,a as b,b as w,d as l,t as c,e as V,g as N,F as U,h as F,j as T}from"./index-1b09309a.js";import{_ as A}from"./InputModal-7dc7ab43.js";import{_ as K}from"./ToastModal-7c205aee.js";const L={class:"flex justify-center my-8 py-16"},P={class:"flex flex-col mx-5"},W={class:"input-label text-base mb-2"},z={key:0,class:"text-center text-slate-700 mt-5 text-sm"},p="saraRegisterEmail",Q={__name:"RegisterView",props:{email:{type:String,required:!0}},setup(G){const m=n(!1),f=n(!1),i=n(""),g=n(""),s=n(""),_=n(""),y=n(""),x=n(""),d=n(""),v=D(),h=T(),S=u(()=>s.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),k=u(()=>s.value?"例如：1234567":"例如：星川 サラ"),C=u(()=>s.value?`請於您的電子郵件信箱 ${g.value} 收取註冊代碼。`:""),j=u(()=>s.value?"text":"email"),E=u(()=>s.value?"請輸入註冊代碼":"請輸入暱稱"),I=u(()=>!!s.value),R=()=>{window.history.length?v.back():v.replace("/")},$=async t=>{if(!t){i.value=E.value;return}i.value="",m.value=!0,s.value?await B(t):await q(t),m.value=!1},q=async t=>{var e;const a=sessionStorage.getItem(p);try{const o=await(await h.post("users",{json:{email:a,nickname:t}})).json();o!=null&&o.session_id?(s.value=o.session_id,_.value=o.session_ua,y.value=o.session_ip,x.value=o.session_tm,g.value=d.value,d.value=""):i.value="發生錯誤 (無錯誤代碼)"}catch(r){const o=((e=r==null?void 0:r.response)==null?void 0:e.status)||"無錯誤代碼";i.value=`發生錯誤 (${o})`,console.error(r.message)}},B=async t=>{var a;try{await h.patch("users",{json:{session_id:s.value,code:t}}),f.value=!0,i.value="註冊成功，正在寫入憑證...",sessionStorage.removeItem(p),F()}catch(e){const r=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";i.value=`發生錯誤 (${r})`,console.error(e.message)}};return M(()=>{sessionStorage.getItem(p)||v.replace("/")}),(t,a)=>(b(),w(U,null,[l("div",L,[l("div",P,[l("label",W,c(S.value),1),V(A,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),loading:m.value,done:f.value,placeholder:k.value,description:C.value,"input-type":j.value,onSubmit:$},null,8,["modelValue","loading","done","placeholder","description","input-type"])])]),l("div",{class:"flex justify-center mt-5"},[l("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:R}," 取消 ")]),I.value?(b(),w("div",z,[l("div",null,"申請時間："+c(x.value||"未知"),1),l("div",null,"申請識別碼："+c(s.value||"未知"),1),l("div",null,"申請來源裝置："+c(_.value||"未知"),1),l("div",null,"申請來源 IP 位址："+c(y.value||"未知"),1)])):N("",!0),V(K,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e)},null,8,["modelValue"])],64))}};export{Q as default};
