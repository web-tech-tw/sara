import{u as C,w as S,a as M,v as j,o as f,c as h,b as d,t as g,r as c,d as B,e as m,f as _,F as R,g as T,h as q}from"./index-0851ead5.js";import{_ as D}from"./InputModal-1acbd8e4.js";const F={class:"flex items-center space-x-2"},I={class:"font-bold"},N={__name:"ToastModal",props:{modelValue:{type:String},modelModifiers:{}},emits:["update:modelValue"],setup(p){let l;const e=C(p,"modelValue");function i(){l&&clearTimeout(l),e.value=""}return S(e,()=>{e.value&&(l=setTimeout(i,3e3))}),(n,u)=>M((f(),h("button",{type:"button",class:"fixed right-2 lg:right-24 top-24 z-50 rounded-md px-4 py-2 text-white transition bg-amber-500 hover:bg-amber-600",onClick:i},[d("div",F,[d("p",I,g(e.value),1)])],512)),[[j,e.value]])}},U={class:"flex justify-center my-8 py-16"},z={class:"flex flex-col mx-5"},A={class:"input-label text-base mb-2"},L={__name:"HomeView",setup(p){const l=c(!1),e=c(""),i=c(""),n=c(""),u=c(""),v=q(),b=B(),x=m(()=>n.value?"請輸入您的登入代碼：":"請輸入您的電子郵件地址："),w=m(()=>n.value?"例如：123456":"例如：sara@web-tech.tw"),y=m(()=>n.value?`請於您的電子郵件信箱 ${i.value} 收取登入代碼。`:""),V=async o=>{if(!o){e.value="請輸入資料";return}e.value="",l.value=!0,n.value?await k(o):await $(o),l.value=!1},$=async o=>{var t,s;try{const r=await(await v.post("tokens",{json:{email:o}})).json();r!=null&&r.session_id?(n.value=r.session_id,i.value=u.value,u.value=""):e.value="發生錯誤 (無錯誤代碼)"}catch(a){if(((t=a==null?void 0:a.response)==null?void 0:t.status)===404)sessionStorage.setItem("sara_register_email",o),b.push("/register");else{const r=((s=a==null?void 0:a.response)==null?void 0:s.status)||"無錯誤代碼";e.value=`發生錯誤 (${r})`,console.error(a.message)}}},k=async o=>{var t;try{await v.patch("tokens",{json:{session_id:n.value,code:o}}),e.value="登入成功，正在寫入憑證...",T()}catch(s){const a=((t=s==null?void 0:s.response)==null?void 0:t.status)||"無錯誤代碼";e.value=`發生錯誤 (${a})`,console.error(s.message)}};return(o,t)=>(f(),h(R,null,[d("div",U,[d("div",z,[d("label",A,g(x.value),1),_(D,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),loading:l.value,placeholder:w.value,description:y.value,onSubmit:V},null,8,["modelValue","loading","placeholder","description"])])]),_(N,{modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=s=>e.value=s)},null,8,["modelValue"])],64))}};export{L as default};
