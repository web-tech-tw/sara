import{o as l,c as b,a as e,n as K,m as E,u as O,r as y,b as V,d as R,e as Z,w as P,v as J,f as W,g as M,h as I,i as D,j as A,t as f,k as G,l as U,F as T,p as Q,s as H,q as B,x as S,y as X,z as Y}from"./index-9dc76a02.js";import{b as ee,s as se,u as j,_ as te}from"./ToastModal-df86368d.js";function oe(v,c){return l(),b("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function N(v,c){return l(),b("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function ne(v,c){return l(),b("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.864 4.243A7.5 7.5 0 0119.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 004.5 10.5a7.464 7.464 0 01-1.15 3.993m1.989 3.559A11.209 11.209 0 008.25 10.5a3.75 3.75 0 117.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 01-3.6 9.75m6.633-4.596a18.666 18.666 0 01-2.485 5.33"})])}const F={__name:"LoadingCircleIcon",props:{class:{type:String,required:!1,default:()=>""}},setup(v){const c=v;return(s,t)=>(l(),b("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:K(c.class)},t[0]||(t[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M 3 11.958 C 3.205 6.522 7.226 2.994 11.995 2.993 L 11.954 1.007 C 5.327 1.007 1.002 5.322 1.002 11.949 L 3 11.958 Z M 5.285 17.992 C 3.993 16.533 2.997 13.906 3 11.957 L 1 11.948 C 1 14.99 1.927 17.208 3.792 19.322 L 5.285 17.992 Z"},null,-1)]),2))}},ae={class:"input-modal"},re={class:"flex rounded bg-white w-auto h-16 shadow-md md:w-[30rem]"},ie=["placeholder","type","disabled"],le=["disabled"],ue=["disabled"],ce={class:"text-base mt-2"},L={__name:"InputModal",props:E({inputPlaceholder:{type:String,required:!1,default:()=>""},inputDescription:{type:String,required:!1,default:()=>""},inputType:{type:String,required:!1,default:()=>"text"},inputHistory:{type:String,required:!1,default:()=>""},isLoad:{type:Boolean,required:!1,default:()=>!0},isDone:{type:Boolean,required:!1,default:()=>!1},noSubmit:{type:Boolean,required:!1,default:()=>!1}},{modelValue:{type:String},modelModifiers:{}}),emits:E(["submit"],["update:modelValue"]),setup(v,{emit:c}){const s=v,t=O(v,"modelValue"),d=c,a=y(!1),p=V(()=>!!s.inputHistory&&!t.value&&a.value),o=V(()=>s.isLoad||s.isDone),x=()=>{t.value=s.inputHistory,a.value=!1},m=()=>{a.value=!0},n=u=>{document.querySelector(".input-modal").contains(u.target)||(a.value=!1)},r=()=>{d("submit",t.value)};return R(()=>{document.addEventListener("click",n)}),Z(()=>{document.removeEventListener("click",n)}),(u,i)=>(l(),b("div",ae,[e("div",re,[P(e("input",{"onUpdate:modelValue":i[0]||(i[0]=h=>t.value=h),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none focus:outline-none",placeholder:s.inputPlaceholder,type:s.inputType,disabled:o.value,onFocus:m,onKeydown:W(r,["enter"])},null,40,ie),[[J,t.value]]),s.noSubmit?D("",!0):(l(),b("button",{key:0,class:"m-2 rounded px-4 py-2 font-semibold",disabled:o.value,onClick:r},[s.isDone?(l(),M(I(N),{key:0,class:"h-6 w-6 my-1"})):s.isLoad?(l(),M(F,{key:1,class:"h-6 w-6 my-1 animate-spin"})):(l(),M(I(oe),{key:2,class:"h-6 w-6 my-1"}))],8,le))]),P(e("button",{class:"w-[90%] mx-auto flex items-center space-x-2 bg-white-500 shadow-md text-md text-slate-700 font-normal py-3 md:px-8 px-4 hover:bg-slate-100 rounded mt-1 animate-fade",disabled:o.value,onClick:x},f(s.inputHistory),9,ue),[[A,p.value]]),e("p",ce,f(s.description),1)]))}},de={class:"flex justify-center my-8 py-16"},pe={class:"flex flex-col mx-5"},me={key:0,class:"flex justify-center mt-5"},ye={key:1,class:"flex justify-center mt-5"},fe="請輸入您的電子郵件地址：",ve="例如：sara@web-tech.tw",xe="email",be={__name:"CreateTokenRequest",emits:["state","status"],setup(v,{emit:c}){const s=y(""),t=y(""),d=y(!1),a=y(!1),p=y(!1),o=y(!1),x=V(()=>ee()&&!o.value),m=V(()=>!!t.value),n=c,r=async()=>{const{value:_}=s;if(!_){n("status",{message:"請輸入電子郵件地址"});return}d.value=!0,await i(_),d.value=!1},u=()=>{Q(),t.value="",n("status",{message:"成功清除登入記錄"})},i=async _=>{var $;const w=j();try{p.value=!0;const C=await w.post("tokens/passkeys",{json:{email:_}}),{session_id:g,session_options:k}=await C.json(),z=await se({optionsJSON:k});await w.patch("tokens/passkeys",{json:{session_id:g,credential:z}}),a.value=!0,n("status",{message:"登入成功，正在寫入憑證..."}),H(_),B()}catch(C){console.error(C);const g=(($=C==null?void 0:C.response)==null?void 0:$.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${g})`}),p.value=!1}},h=async _=>{var $,C;const w=j();try{o.value=!0;const k=await(await w.post("tokens",{json:{email:_}})).json();if(!(k!=null&&k.session_id)){n("status",{message:"發生錯誤 (無錯誤代碼)"});return}n("state",{name:"CreateTokenVerify",props:{sessionId:k.session_id,sessionTm:k.session_tm,sessionUa:k.session_ua,sessionIp:k.session_ip,currentMail:_}})}catch(g){if((($=g==null?void 0:g.response)==null?void 0:$.status)===404){n("state",{name:"CreateTokenEmpty",props:{currentMail:_}});return}console.error(g);const k=((C=g==null?void 0:g.response)==null?void 0:C.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${k})`}),o.value=!1}},q=async _=>{if(!_){n("status",{message:"請輸入電子郵件地址"});return}d.value=!0,await h(_),d.value=!1};return R(()=>{t.value=G()}),(_,w)=>(l(),b(T,null,[e("div",de,[e("div",pe,[e("label",{class:"input-label text-base mb-2"},f(fe)),U(L,{modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=$=>s.value=$),"input-placeholder":ve,"input-type":xe,"input-history":t.value,"is-load":d.value,"is-done":a.value,"no-submit":p.value,onSubmit:q},null,8,["modelValue","input-history","is-load","is-done","no-submit"])])]),x.value?(l(),b("div",me,[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:r},[e("span",null,[a.value?(l(),M(I(N),{key:0,class:"h-5 w-5"})):d.value?(l(),M(F,{key:1,class:"h-5 w-5 animate-spin"})):(l(),M(I(ne),{key:2,class:"h-5 w-5"}))]),w[1]||(w[1]=e("span",{class:"font-bold"}," Passkey ",-1))])])):D("",!0),m.value?(l(),b("div",ye,[e("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:u},w[2]||(w[2]=[e("span",{class:"font-bold"}," 清除登入記錄 ",-1)]))])):D("",!0)],64))}},he={class:"flex justify-center my-8 py-16"},_e={class:"flex flex-col mx-auto"},ge={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},we={class:"overflow-hidden shadow-md"},ke={class:"p-6 bg-white border-b border-gray-200"},Ce={class:"text-slate-900 my-3"},Se={__name:"CreateTokenEmpty",props:{currentMail:{type:String,required:!0}},emits:["state"],setup(v,{emit:c}){const s=v,t=c,d=()=>{t("state",{name:"CreateUserRequest",props:{currentMail:s.currentMail}})},a=()=>{location.reload()};return(p,o)=>(l(),b("div",he,[e("div",_e,[e("div",ge,[e("div",we,[o[2]||(o[2]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 尚未註冊 ",-1)),e("div",ke,[o[0]||(o[0]=S(" 您好，您輸入的電子郵件地址： ")),e("div",Ce,f(s.currentMail),1),o[1]||(o[1]=S(" 尚未於 Sara 系統註冊帳號。 "))]),o[3]||(o[3]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您確定曾經註冊過："),e("br"),S(" 請檢查您輸入的電子郵件地址，"),e("br"),S(" 並點選「取消」以重新輸入。 ")],-1)),o[4]||(o[4]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您未曾註冊："),e("br"),S(" 請點選「註冊」以進行註冊。"),e("br"),S(" 註冊即代表您同意我們的 "),e("a",{href:"https://web-tech.tw/#/privacy",class:"text-sky-500 hover:text-sky-700",target:"_blank"}," 隱私權政策 "),S("。 ")],-1)),e("div",{class:"p-6 bg-white border-b border-gray-200 text-right"},[e("button",{class:"bg-amber-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-amber-600 rounded mr-3",onClick:d}," 註冊 "),e("button",{class:"bg-white shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:a}," 取消 ")])])])])]))}},$e={class:"flex justify-center my-8 py-16"},Me={class:"flex flex-col mx-5"},qe={class:"text-center text-slate-700 mt-5 text-sm"},Ve={class:"text-center text-slate-700 mt-5 text-sm"},je="請輸入您的登入代碼：",Ue="例如：123456",Te={__name:"CreateTokenVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["status"],setup(v,{emit:c}){const s=v,t=c,d=`請於您的電子郵件信箱 ${s.currentMail} 收取登入代碼。`,a=y(""),p=y(!1),o=y(!1),x=()=>{location.reload()},m=async r=>{var i;const u=j();try{await u.patch("tokens",{json:{session_id:s.sessionId,code:r}}),o.value=!0,t("status",{message:"登入成功，正在寫入憑證..."}),H(s.currentMail),B()}catch(h){console.error(h);const q=((i=h==null?void 0:h.response)==null?void 0:i.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${q})`})}},n=async r=>{if(!r){t("status",{message:"請輸入登入代碼"});return}p.value=!0,await m(r),p.value=!1};return(r,u)=>(l(),b(T,null,[e("div",$e,[e("div",Me,[e("label",{class:"input-label text-base mb-2"},f(je)),U(L,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=i=>a.value=i),"input-description":d,"input-placeholder":Ue,"is-load":p.value,"is-done":o.value,onSubmit:n},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:x}," 取消 ")]),e("div",qe,[e("div",null,"申請時間："+f(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+f(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+f(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+f(s.sessionIp||"未知"),1)]),e("div",Ve,[e("div",null,"目標電子郵件地址："+f(s.currentMail||"未知"),1)])],64))}},Ie={class:"flex justify-center my-8 py-16"},Le={class:"flex flex-col mx-5"},Pe={class:"text-center text-slate-700 mt-5 text-sm"},De="請輸入您的暱稱：",He="例如：星川 サラ",Be={__name:"CreateUserRequest",props:{currentMail:{type:String,required:!0}},emits:["state","status"],setup(v,{emit:c}){const s=v,t=c,d=y(""),a=y(!1),p=()=>{location.reload()},o=async m=>{var r;const n=j();try{const i=await(await n.post("users",{json:{email:s.currentMail,nickname:m}})).json();t("state",{name:"CreateUserVerify",props:{sessionId:i.session_id,sessionTm:i.session_tm,sessionUa:i.session_ua,sessionIp:i.session_ip,currentMail:s.currentMail}})}catch(u){console.error(u);const i=((r=u==null?void 0:u.response)==null?void 0:r.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${i})`})}},x=async m=>{if(!m){t("status",{message:"請輸入暱稱"});return}a.value=!0,await o(m),a.value=!1};return(m,n)=>(l(),b(T,null,[e("div",Ie,[e("div",Le,[e("label",{class:"input-label text-base mb-2"},f(De)),U(L,{modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=r=>d.value=r),"input-placeholder":He,"is-load":a.value,onSubmit:x},null,8,["modelValue","is-load"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:p}," 取消 ")]),e("div",Pe,[e("div",null,"目標電子郵件地址："+f(s.currentMail||"未知"),1)])],64))}},Ee={class:"flex justify-center my-8 py-16"},Re={class:"flex flex-col mx-5"},Ae={class:"text-center text-slate-700 mt-5 text-sm"},Ne={class:"text-center text-slate-700 mt-5 text-sm"},Fe="請輸入您的註冊代碼：",ze="例如：1234567",Ke={__name:"CreateUserVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["state","status"],setup(v,{emit:c}){const s=v,t=c,d=`請於您的電子郵件信箱 ${s.currentMail} 收取註冊代碼。`,a=y(""),p=y(!1),o=y(!1),x=()=>{location.reload()},m=async r=>{var i;const u=j();try{await u.patch("users",{json:{session_id:s.sessionId,code:r}}),o.value=!0,t("status",{message:"註冊成功，正在寫入憑證..."}),H(s.currentMail),B()}catch(h){console.error(h);const q=((i=h==null?void 0:h.response)==null?void 0:i.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${q})`})}},n=async r=>{if(!r){t("status",{message:"請輸入註冊代碼"});return}p.value=!0,await m(r),p.value=!1};return(r,u)=>(l(),b(T,null,[e("div",Ee,[e("div",Re,[e("label",{class:"input-label text-base mb-2"},f(Fe)),U(L,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=i=>a.value=i),"input-description":d,"input-placeholder":ze,"is-load":p.value,"is-done":o.value,onSubmit:n},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:x}," 取消 ")]),e("div",Ae,[e("div",null,"申請時間："+f(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+f(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+f(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+f(s.sessionIp||"未知"),1)]),P(e("div",Ne,[e("div",null,"目標電子郵件地址："+f(s.currentMail||"未知"),1)],512),[[A,s.currentMail]])],64))}},Je={__name:"HomeView",setup(v){const c=y("CreateTokenRequest"),s=y(null),t=y(""),d={CreateTokenRequest:be,CreateTokenEmpty:Se,CreateTokenVerify:Te,CreateUserRequest:Be,CreateUserVerify:Ke},a=V(()=>d[c.value]),p=({name:x,props:m})=>{c.value=x,s.value=m??{},requestAnimationFrame(()=>{window.scroll({behavior:"smooth",top:0})})},o=({message:x})=>{t.value=x};return(x,m)=>(l(),b(T,null,[(l(),M(Y(a.value),X(s.value,{onState:p,onStatus:o}),null,16)),U(te,{modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=n=>t.value=n)},null,8,["modelValue"])],64))}};export{Je as default};
