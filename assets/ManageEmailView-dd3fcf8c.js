import{r as n,u as B,c as u,a as h,b as g,d as t,t as r,f as w,h as M,w as N,v as R,F as T,k as U}from"./index-0430810d.js";import{_ as q}from"./InputModal-4506d1cc.js";import{_ as F}from"./ToastModal-f4ab1dcb.js";const H={class:"flex justify-center my-8 py-16"},L={class:"flex flex-col mx-5"},K={class:"input-label text-base mb-2"},P={key:0,class:"text-center text-slate-700 mt-5 text-sm"},W={class:"text-center text-slate-700 mt-5 text-sm"},z="saraLoginEmailHistory",Q={__name:"ManageEmailView",setup(A){const d=n(!1),p=n(!1),i=n(""),c=n(""),a=n(""),_=n(""),f=n(""),x=n(""),v=n(""),m=B(),y=U(),b=u(()=>a.value?"請輸入您的轉移代碼：":"請輸入新的電子郵件地址："),V=u(()=>a.value?"例如：12345678":"例如：sara@web-tech.tw"),k=u(()=>a.value?`請於新的電子郵件信箱 ${c.value} 收取轉移代碼。`:""),C=u(()=>a.value?"text":"email"),S=u(()=>a.value?"請輸入轉移代碼":"請輸入電子郵件地址"),j=u(()=>!!a.value),$=()=>{window.history.length?m.back():m.replace("/")},D=async o=>{if(!o){i.value=S.value;return}i.value="",d.value=!0,a.value?await I(o):await E(o),d.value=!1},E=async o=>{var l;try{const s=await(await y.put("users/me/email",{json:{email:o}})).json();s!=null&&s.session_id?(a.value=s.session_id,_.value=s.session_ua,f.value=s.session_ip,x.value=s.session_tm,c.value=o,v.value=""):i.value="發生錯誤 (無錯誤代碼)"}catch(e){const s=((l=e==null?void 0:e.response)==null?void 0:l.status)||"無錯誤代碼";i.value=`發生錯誤 (${s})`,console.error(e.message)}},I=async o=>{var l;try{await y.patch("users/me/email",{json:{session_id:a.value,code:o}}),p.value=!0,i.value="修改成功，正在寫入憑證...",localStorage.setItem(z,c.value),setTimeout(()=>m.replace("/manage"),500)}catch(e){const s=((l=e==null?void 0:e.response)==null?void 0:l.status)||"無錯誤代碼";i.value=`發生錯誤 (${s})`,console.error(e.message)}};return(o,l)=>(h(),g(T,null,[t("div",H,[t("div",L,[t("label",K,r(b.value),1),w(q,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),loading:d.value,done:p.value,placeholder:V.value,description:k.value,"input-type":C.value,onSubmit:D},null,8,["modelValue","loading","done","placeholder","description","input-type"])])]),t("div",{class:"flex justify-center mt-5"},[t("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:$}," 取消 ")]),j.value?(h(),g("div",P,[t("div",null,"申請時間："+r(x.value||"未知"),1),t("div",null,"申請識別碼："+r(a.value||"未知"),1),t("div",null,"申請來源裝置："+r(_.value||"未知"),1),t("div",null,"申請來源 IP 位址："+r(f.value||"未知"),1)])):M("",!0),N(t("div",W,[t("div",null,"目標電子郵件地址："+r(c.value||"未知"),1)],512),[[R,c.value]]),w(F,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value=e)},null,8,["modelValue"])],64))}};export{Q as default};
