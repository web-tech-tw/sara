import{r,u as D,c as i,o as F,a as p,b as m,d as t,t as v,e as x,f as K,g as _,F as L,h as T,i as A,j as E}from"./index-264cd9b1.js";import{_ as W}from"./InputModal-599f3a07.js";import{_ as z}from"./ToastModal-0a1d87d8.js";const G={class:"flex justify-center my-8 py-16"},J={class:"flex flex-col mx-5"},O={class:"input-label text-base mb-2"},Q={key:0,class:"flex justify-center mt-5"},X={key:1,class:"flex justify-center mt-5"},Y={key:2,class:"text-center text-slate-700 mt-5 text-sm"},g="saraInputHistoryLogin",ae={__name:"HomeView",setup(Z){const y=r(!1),c=r(""),o=r(""),f=r(""),s=r(""),b=r(""),h=r(""),k=r(""),d=r(""),w=E(),S=D(),C=i(()=>s.value?"請輸入您的登入代碼：":"請輸入您的電子郵件地址："),V=i(()=>s.value?"例如：123456":"例如：sara@web-tech.tw"),I=i(()=>s.value?`請於您的電子郵件信箱 ${f.value} 收取登入代碼。`:""),j=i(()=>s.value?"text":"email"),H=i(()=>s.value?"請輸入登入代碼":"請輸入電子郵件地址"),$=i(()=>!s.value),B=i(()=>!s.value&&!!c.value),M=i(()=>!!s.value),N=()=>{o.value="尚未實作"},P=()=>{localStorage.removeItem(g),c.value="",o.value="成功清除登入記錄"},R=async n=>{if(!n){o.value=H.value;return}o.value="",y.value=!0,s.value?await q(n):await U(n),y.value=!1},U=async n=>{var e,a;try{const u=await(await w.post("tokens",{json:{email:n}})).json();u!=null&&u.session_id?(s.value=u.session_id,b.value=u.session_ua,h.value=u.session_ip,k.value=u.session_tm,f.value=d.value,c.value="",d.value=""):o.value="發生錯誤 (無錯誤代碼)"}catch(l){if(((e=l==null?void 0:l.response)==null?void 0:e.status)===404)sessionStorage.setItem("sara_register_email",n),S.push("/register");else{const u=((a=l==null?void 0:l.response)==null?void 0:a.status)||"無錯誤代碼";o.value=`發生錯誤 (${u})`,console.error(l.message)}}},q=async n=>{var e;try{await w.patch("tokens",{json:{session_id:s.value,code:n}}),o.value="登入成功，正在寫入憑證...",localStorage.setItem(g,f.value),T()}catch(a){const l=((e=a==null?void 0:a.response)==null?void 0:e.status)||"無錯誤代碼";o.value=`發生錯誤 (${l})`,console.error(a.message)}};return F(()=>{c.value=localStorage.getItem(g)}),(n,e)=>(p(),m(L,null,[t("div",G,[t("div",J,[t("label",O,v(C.value),1),x(W,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),loading:y.value,placeholder:V.value,description:I.value,"input-type":j.value,"input-history":c.value,onSubmit:R},null,8,["modelValue","loading","placeholder","description","input-type","input-history"])])]),$.value?(p(),m("div",Q,[t("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:N},[t("span",null,[x(K(A),{class:"h-5 w-5"})]),e[2]||(e[2]=t("span",{class:"font-bold"}," Passkey ",-1))])])):_("",!0),B.value?(p(),m("div",X,[t("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:P},e[3]||(e[3]=[t("span",{class:"font-bold"}," 移除登入記錄 ",-1)]))])):_("",!0),M.value?(p(),m("div",Y,[t("div",null,"申請時間："+v(k.value||"未知"),1),t("div",null,"申請識別碼："+v(s.value||"未知"),1),t("div",null,"申請來源裝置："+v(b.value||"未知"),1),t("div",null,"申請來源 IP 位址："+v(h.value||"未知"),1)])):_("",!0),x(z,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a)},null,8,["modelValue"])],64))}};export{ae as default};
