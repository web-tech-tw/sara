import{u as M,H as B,w as j,j as $,o as G,c as W,a as E,l as F,h as J,t as Y,I as z}from"./index-acc1701c.js";function d(t){const e=new Uint8Array(t);let r="";for(const o of e)r+=String.fromCharCode(o);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function R(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4,s=e.padEnd(e.length+r,"="),o=atob(s),n=new ArrayBuffer(o.length),a=new Uint8Array(n);for(let i=0;i<o.length;i++)a[i]=o.charCodeAt(i);return n}function I(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function q(t){const{id:e}=t;return{...t,id:R(e),transports:t.transports}}function D(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}class c extends Error{constructor({message:e,code:r,cause:s,name:o}){super(e,{cause:s}),this.name=o??s.name,this.code=r}}function X({error:t,options:e}){var s,o,n;const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new c({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((s=r.authenticatorSelection)==null?void 0:s.requireResidentKey)===!0)return new c({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((o=r.authenticatorSelection)==null?void 0:o.userVerification)==="required")return new c({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((n=r.authenticatorSelection)==null?void 0:n.userVerification)==="required")return new c({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new c({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new c({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return r.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new c({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new c({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const a=window.location.hostname;if(D(a)){if(r.rp.id!==a)return new c({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new c({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new c({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return t}class Q{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const U=new Q,Z=["cross-platform","platform"];function k(t){if(t&&!(Z.indexOf(t)<0))return t}async function Ae(t){var y;const{optionsJSON:e,useAutoRegister:r=!1}=t;if(!I())throw new Error("WebAuthn is not supported in this browser");const s={...e,challenge:R(e.challenge),user:{...e.user,id:R(e.user.id)},excludeCredentials:(y=e.excludeCredentials)==null?void 0:y.map(q)},o={};r&&(o.mediation="conditional"),o.publicKey=s,o.signal=U.createNewAbortSignal();let n;try{n=await navigator.credentials.create(o)}catch(f){throw X({error:f,options:o})}if(!n)throw new Error("Registration was not completed");const{id:a,rawId:i,response:u,type:h}=n;let l;typeof u.getTransports=="function"&&(l=u.getTransports());let b;if(typeof u.getPublicKeyAlgorithm=="function")try{b=u.getPublicKeyAlgorithm()}catch(f){A("getPublicKeyAlgorithm()",f)}let p;if(typeof u.getPublicKey=="function")try{const f=u.getPublicKey();f!==null&&(p=d(f))}catch(f){A("getPublicKey()",f)}let m;if(typeof u.getAuthenticatorData=="function")try{m=d(u.getAuthenticatorData())}catch(f){A("getAuthenticatorData()",f)}return{id:a,rawId:d(i),response:{attestationObject:d(u.attestationObject),clientDataJSON:d(u.clientDataJSON),transports:l,publicKeyAlgorithm:b,publicKey:p,authenticatorData:m},type:h,clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:k(n.authenticatorAttachment)}}function A(t,e){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${t}. You should report this error to them.
`,e)}function ee(){if(!I())return new Promise(e=>e(!1));const t=window.PublicKeyCredential;return t.isConditionalMediationAvailable===void 0?new Promise(e=>e(!1)):t.isConditionalMediationAvailable()}function te({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new c({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new c({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const s=window.location.hostname;if(D(s)){if(r.rpId!==s)return new c({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new c({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return t}async function Te(t){var m,y;const{optionsJSON:e,useBrowserAutofill:r=!1,verifyBrowserAutofillInput:s=!0}=t;if(!I())throw new Error("WebAuthn is not supported in this browser");let o;((m=e.allowCredentials)==null?void 0:m.length)!==0&&(o=(y=e.allowCredentials)==null?void 0:y.map(q));const n={...e,challenge:R(e.challenge),allowCredentials:o},a={};if(r){if(!await ee())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&s)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');a.mediation="conditional",n.allowCredentials=[]}a.publicKey=n,a.signal=U.createNewAbortSignal();let i;try{i=await navigator.credentials.get(a)}catch(f){throw te({error:f,options:a})}if(!i)throw new Error("Authentication was not completed");const{id:u,rawId:h,response:l,type:b}=i;let p;return l.userHandle&&(p=d(l.userHandle)),{id:u,rawId:d(h),response:{authenticatorData:d(l.authenticatorData),clientDataJSON:d(l.clientDataJSON),signature:d(l.signature),userHandle:p},type:b,clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:k(i.authenticatorAttachment)}}class v extends Error{constructor(e,r,s){const o=e.status||e.status===0?e.status:"",n=e.statusText||"",a=`${o} ${n}`.trim(),i=a?`status code ${a}`:"an unknown error";super(`Request failed with ${i}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="HTTPError",this.response=e,this.request=r,this.options=s}}class x extends Error{constructor(e){super("Request timed out"),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimeoutError",this.request=e}}const _=t=>t!==null&&typeof t=="object",w=(...t)=>{for(const e of t)if((!_(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return O({},...t)},K=(t={},e={})=>{const r=new globalThis.Headers(t),s=e instanceof globalThis.Headers,o=new globalThis.Headers(e);for(const[n,a]of o.entries())s&&a==="undefined"||a===void 0?r.delete(n):r.set(n,a);return r},O=(...t)=>{let e={},r={};for(const s of t)if(Array.isArray(s))Array.isArray(e)||(e=[]),e=[...e,...s];else if(_(s)){for(let[o,n]of Object.entries(s))_(n)&&o in e&&(n=O(e[o],n)),e={...e,[o]:n};_(s.headers)&&(r=K(r,s.headers),e.headers=r)}return e},re=(()=>{let t=!1,e=!1;const r=typeof globalThis.ReadableStream=="function",s=typeof globalThis.Request=="function";return r&&s&&(e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")),t&&!e})(),se=typeof globalThis.AbortController=="function",oe=typeof globalThis.ReadableStream=="function",ne=typeof globalThis.FormData=="function",V=["get","post","put","patch","head","delete"],ie={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},T=2147483647,L=Symbol("stop"),ae=t=>V.includes(t)?t.toUpperCase():t,ue=["get","put","head","delete","options","trace"],ce=[408,413,429,500,502,503,504],H=[413,429,503],N={limit:2,methods:ue,statusCodes:ce,afterStatusCodes:H,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY},le=(t={})=>{if(typeof t=="number")return{...N,limit:t};if(t.methods&&!Array.isArray(t.methods))throw new Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw new Error("retry.statusCodes must be an array");return{...N,...t,afterStatusCodes:H}};async function he(t,e,r){return new Promise((s,o)=>{const n=setTimeout(()=>{e&&e.abort(),o(new x(t))},r.timeout);r.fetch(t).then(s).catch(o).then(()=>{clearTimeout(n)})})}async function fe(t,{signal:e}){return new Promise((r,s)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",o,{once:!0}));function o(){clearTimeout(n),s(e.reason)}const n=setTimeout(()=>{e==null||e.removeEventListener("abort",o),r()},t)})}class g{static create(e,r){const s=new g(e,r),o=async()=>{if(typeof s._options.timeout=="number"&&s._options.timeout>T)throw new RangeError(`The \`timeout\` option cannot be greater than ${T}`);await Promise.resolve();let i=await s._fetch();for(const u of s._options.hooks.afterResponse){const h=await u(s.request,s._options,s._decorateResponse(i.clone()));h instanceof globalThis.Response&&(i=h)}if(s._decorateResponse(i),!i.ok&&s._options.throwHttpErrors){let u=new v(i,s.request,s._options);for(const h of s._options.hooks.beforeError)u=await h(u);throw u}if(s._options.onDownloadProgress){if(typeof s._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!oe)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return s._stream(i.clone(),s._options.onDownloadProgress)}return i},a=s._options.retry.methods.includes(s.request.method.toLowerCase())?s._retry(o):o();for(const[i,u]of Object.entries(ie))a[i]=async()=>{s.request.headers.set("accept",s.request.headers.get("accept")||u);const l=(await a).clone();if(i==="json"){if(l.status===204||(await l.clone().arrayBuffer()).byteLength===0)return"";if(r.parseJson)return r.parseJson(await l.text())}return l[i]()};return a}constructor(e,r={}){if(Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_retryCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._input=e,this._options={credentials:this._input.credentials||"same-origin",...r,headers:K(this._input.headers,r.headers),hooks:O({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:ae(r.method??this._input.method),prefixUrl:String(r.prefixUrl||""),retry:le(r.retry),throwHttpErrors:r.throwHttpErrors!==!1,timeout:r.timeout??1e4,fetch:r.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(se){if(this.abortController=new globalThis.AbortController,this._options.signal){const s=this._options.signal;this._options.signal.addEventListener("abort",()=>{this.abortController.abort(s.reason)})}this._options.signal=this.abortController.signal}if(re&&(this._options.duplex="half"),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const o="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),n=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,o);(ne&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(n,{...this.request}),this._options)}this._options.json!==void 0&&(this._options.body=JSON.stringify(this._options.json),this.request.headers.set("content-type",this._options.headers.get("content-type")??"application/json"),this.request=new globalThis.Request(this.request,{body:this._options.body}))}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount<this._options.retry.limit&&!(e instanceof x)){if(e instanceof v){if(!this._options.retry.statusCodes.includes(e.response.status))return 0;const s=e.response.headers.get("Retry-After");if(s&&this._options.retry.afterStatusCodes.includes(e.response.status)){let o=Number(s);return Number.isNaN(o)?o=Date.parse(s)-Date.now():o*=1e3,this._options.retry.maxRetryAfter!==void 0&&o>this._options.retry.maxRetryAfter?0:o}if(e.response.status===413)return 0}const r=.3;return Math.min(this._options.retry.backoffLimit,r*2**(this._retryCount-1)*1e3)}return 0}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(r){const s=Math.min(this._calculateRetryDelay(r),T);if(s!==0&&this._retryCount>0){await fe(s,{signal:this._options.signal});for(const o of this._options.hooks.beforeRetry)if(await o({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===L)return;return this._retry(e)}throw r}}async _fetch(){for(const e of this._options.hooks.beforeRequest){const r=await e(this.request,this._options);if(r instanceof Request){this.request=r;break}if(r instanceof Response)return r}return this._options.timeout===!1?this._options.fetch(this.request.clone()):he(this.request.clone(),this.abortController,this._options)}_stream(e,r){const s=Number(e.headers.get("content-length"))||0;let o=0;return e.status===204?(r&&r({percent:1,totalBytes:s,transferredBytes:o},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(n){const a=e.body.getReader();r&&r({percent:0,transferredBytes:0,totalBytes:s},new Uint8Array);async function i(){const{done:u,value:h}=await a.read();if(u){n.close();return}if(r){o+=h.byteLength;const l=s===0?0:o/s;r({percent:l,transferredBytes:o,totalBytes:s},h)}n.enqueue(h),await i()}await i()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License Â© Sindre Sorhus */const S=t=>{const e=(r,s)=>g.create(r,w(t,s));for(const r of V)e[r]=(s,o)=>g.create(s,w(t,o,{method:r}));return e.create=r=>S(w(r)),e.extend=r=>S(w(t,r)),e.stop=L,e},de=S(),pe=de,{VITE_SARA_RECV_HOST:be,VITE_SARA_TOKEN_NAME:C,VITE_SARA_GUARD_NAME:P}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_RECV_HOST:"https://web-tech.tw/recv/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_SARA_GUARD_NAME:"guard_token",BASE_URL:"/sara/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},me=t=>{const e=localStorage.getItem(C),r=localStorage.getItem(P);if(!e||!r)return;const s=[e,r].join("|");t.headers.set("authorization",`XARA ${s}`)},ye=(t,e,r)=>{const s=r.headers.get("x-sara-refresh");if(!s)return;const[o,n]=s.split("|",2);localStorage.setItem(C,o),localStorage.setItem(P,n)},we=(t,e,r)=>{r.status===401&&(localStorage.removeItem(C),localStorage.removeItem(P))},_e=pe.create({prefixUrl:be,hooks:{beforeRequest:[me],afterResponse:[ye,we]}}),Se=()=>_e,Re={class:"flex items-center space-x-2"},ge={class:"font-bold"},Ie={__name:"ToastModal",props:{modelValue:{type:String},modelModifiers:{}},emits:["update:modelValue"],setup(t){let e;const r=M(t,"modelValue"),s=()=>{e&&clearTimeout(e),r.value=""};return B(r,()=>{r.value&&(e=setTimeout(s,3e3))}),(o,n)=>j((G(),W("button",{type:"button",class:"fixed right-2 lg:right-24 top-24 z-50 rounded-md px-4 py-2 text-white transition bg-amber-500 hover:bg-amber-600 animate-fade",onClick:s},[E("div",Re,[E("span",null,[F(J(z),{class:"h-5 w-5"})]),E("span",ge,Y(r.value),1)])],512)),[[$,r.value]])}};export{Ie as _,Ae as a,I as b,Te as s,Se as u};
