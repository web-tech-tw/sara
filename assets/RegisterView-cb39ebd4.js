import{r,u as q,c as u,o as B,a as y,b as h,d as l,t as c,e as b,g as M,F as N,h as U,j as D}from"./index-264cd9b1.js";import{_ as F}from"./InputModal-599f3a07.js";import{_ as T}from"./ToastModal-0a1d87d8.js";const A={class:"flex justify-center my-8 py-16"},L={class:"flex flex-col mx-5"},P={class:"input-label text-base mb-2"},W={key:0,class:"text-center text-slate-700 mt-5 text-sm"},K={__name:"RegisterView",props:{email:{type:String,required:!0}},setup(z){const d=r(!1),n=r(""),p=r(""),s=r(""),_=r(""),g=r(""),f=r(""),m=r(""),v=q(),x=D(),w=u(()=>s.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),V=u(()=>s.value?"例如：1234567":"例如：星川 サラ"),S=u(()=>s.value?`請於您的電子郵件信箱 ${p.value} 收取註冊代碼。`:""),k=u(()=>s.value?"text":"email"),C=u(()=>s.value?"請輸入註冊代碼":"請輸入暱稱"),j=u(()=>!!s.value),I=()=>{window.history.length?v.back():v.replace("/")},$=async t=>{if(!t){n.value=C.value;return}n.value="",d.value=!0,s.value?await R(t):await E(t),d.value=!1},E=async t=>{var e;const a=sessionStorage.getItem("sara_register_email");try{const o=await(await x.post("users",{json:{email:a,nickname:t}})).json();o!=null&&o.session_id?(s.value=o.session_id,_.value=o.session_ua,g.value=o.session_ip,f.value=o.session_tm,p.value=m.value,m.value=""):n.value="發生錯誤 (無錯誤代碼)"}catch(i){const o=((e=i==null?void 0:i.response)==null?void 0:e.status)||"無錯誤代碼";n.value=`發生錯誤 (${o})`,console.error(i.message)}},R=async t=>{var a;try{await x.patch("users",{json:{session_id:s.value,code:t}}),n.value="註冊成功，正在寫入憑證...",sessionStorage.removeItem("sara_register_email"),U()}catch(e){const i=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";n.value=`發生錯誤 (${i})`,console.error(e.message)}};return B(()=>{sessionStorage.getItem("sara_register_email")||v.replace("/")}),(t,a)=>(y(),h(N,null,[l("div",A,[l("div",L,[l("label",P,c(w.value),1),b(F,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),loading:d.value,placeholder:V.value,description:S.value,"input-type":k.value,onSubmit:$},null,8,["modelValue","loading","placeholder","description","input-type"])])]),l("div",{class:"flex justify-center mt-5"},[l("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:I}," 取消 ")]),j.value?(y(),h("div",W,[l("div",null,"申請時間："+c(f.value||"未知"),1),l("div",null,"申請識別碼："+c(s.value||"未知"),1),l("div",null,"申請來源裝置："+c(_.value||"未知"),1),l("div",null,"申請來源 IP 位址："+c(g.value||"未知"),1)])):M("",!0),b(T,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e)},null,8,["modelValue"])],64))}};export{K as default};
