import{r as i,u as W,c as d,o as J,a as v,b,d as e,e as u,t as p,f as V,g as I,h as z,i as w,w as G,v as Q,F as X,j as $,k as Y}from"./index-cc52ad53.js";import{_ as Z,a as ee}from"./InputModal-88660299.js";import{b as se,s as te}from"./index-a06124f1.js";import{_ as oe,u as ae}from"./ToastModal-86f0f815.js";const le={key:0},ne={class:"flex justify-center my-8 py-16"},re={class:"flex flex-col mx-auto"},ie={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},ue={class:"overflow-hidden shadow-md"},ce={class:"p-6 bg-white border-b border-gray-200"},de={class:"text-slate-900 my-3"},ve={key:1},pe={class:"flex justify-center my-8 py-16"},me={class:"flex flex-col mx-5"},be={class:"input-label text-base mb-2"},ye={key:0,class:"flex justify-center mt-5"},xe={key:1,class:"flex justify-center mt-5"},fe={key:2,class:"text-center text-slate-700 mt-5 text-sm"},ge={class:"text-center text-slate-700 mt-5 text-sm"},g="saraLoginEmailHistory",he="saraRegisterEmail",je={__name:"HomeView",setup(we){const m=i(!1),h=i(!1),_=i(!0),y=i(""),l=i(""),c=i(""),n=i(""),k=i(""),S=i(""),C=i(""),x=i(""),f=ae(),H=W(),R=d(()=>n.value?"請輸入您的登入代碼：":"請輸入您的電子郵件地址："),E=d(()=>n.value?"例如：123456":"例如：sara@web-tech.tw"),N=d(()=>n.value?`請於您的電子郵件信箱 ${c.value} 收取登入代碼。`:""),B=d(()=>n.value?"text":"email"),j=d(()=>n.value?"請輸入登入代碼":"請輸入電子郵件地址"),D=d(()=>se()&&!n.value),A=d(()=>!n.value&&!!y.value),K=d(()=>!!n.value),M=async()=>{var s;const{value:o}=x;if(!o){l.value=j.value;return}m.value=!0;try{const t=await f.post("tokens/passkeys",{json:{email:o}}),{session_id:a,session_options:r}=await t.json(),O=await te({optionsJSON:r});await f.patch("tokens/passkeys",{json:{session_id:a,credential:O}}),h.value=!0,l.value="登入成功，正在寫入憑證...",localStorage.setItem(g,o),$()}catch(t){const a=((s=t==null?void 0:t.response)==null?void 0:s.status)||"無錯誤代碼";l.value=`發生錯誤 (${a})`,console.error(t.message),m.value=!1}},P=()=>{localStorage.removeItem(g),y.value="",l.value="成功清除登入記錄"},T=()=>{sessionStorage.setItem(he,c.value),H.push("/register")},U=()=>{location.reload()},q=async o=>{if(!o){l.value=j.value;return}l.value="",m.value=!0,n.value?await L(o):await F(o),m.value=!1},F=async o=>{var s,t;try{const r=await(await f.post("tokens",{json:{email:o}})).json();r!=null&&r.session_id?(n.value=r.session_id,k.value=r.session_ua,S.value=r.session_ip,C.value=r.session_tm,c.value=o,y.value="",x.value=""):l.value="發生錯誤 (無錯誤代碼)"}catch(a){if(((s=a==null?void 0:a.response)==null?void 0:s.status)===404)c.value=o,_.value=!1,x.value="";else{const r=((t=a==null?void 0:a.response)==null?void 0:t.status)||"無錯誤代碼";l.value=`發生錯誤 (${r})`,console.error(a.message)}}},L=async o=>{var s;try{await f.patch("tokens",{json:{session_id:n.value,code:o}}),h.value=!0,l.value="登入成功，正在寫入憑證...",localStorage.setItem(g,c.value),$()}catch(t){const a=((s=t==null?void 0:t.response)==null?void 0:s.status)||"無錯誤代碼";l.value=`發生錯誤 (${a})`,console.error(t.message)}};return J(()=>{y.value=localStorage.getItem(g)}),(o,s)=>(v(),b(X,null,[_.value?(v(),b("div",ve,[e("div",pe,[e("div",me,[e("label",be,p(R.value),1),V(Z,{modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t),loading:m.value,done:h.value,placeholder:E.value,description:N.value,"input-type":B.value,"input-history":y.value,onSubmit:q},null,8,["modelValue","loading","done","placeholder","description","input-type","input-history"])])]),D.value?(v(),b("div",ye,[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:M},[e("span",null,[m.value?(v(),I(ee,{key:0,class:"h-5 w-5 animate-spin"})):(v(),I(z(Y),{key:1,class:"h-5 w-5"}))]),s[7]||(s[7]=e("span",{class:"font-bold"}," Passkey ",-1))])])):w("",!0),A.value?(v(),b("div",xe,[e("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:P},s[8]||(s[8]=[e("span",{class:"font-bold"}," 清除登入記錄 ",-1)]))])):w("",!0),K.value?(v(),b("div",fe,[e("div",null,"申請時間："+p(C.value||"未知"),1),e("div",null,"申請識別碼："+p(n.value||"未知"),1),e("div",null,"申請來源裝置："+p(k.value||"未知"),1),e("div",null,"申請來源 IP 位址："+p(S.value||"未知"),1)])):w("",!0),G(e("div",ge,[e("div",null,"目標電子郵件地址："+p(c.value||"未知"),1)],512),[[Q,c.value]])])):(v(),b("div",le,[e("div",ne,[e("div",re,[e("div",ie,[e("div",ue,[s[4]||(s[4]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 尚未註冊 ",-1)),e("div",ce,[s[2]||(s[2]=u(" 您好，您輸入的電子郵件地址： ")),e("div",de,p(c.value),1),s[3]||(s[3]=u(" 尚未於 Sara 系統註冊帳號。 "))]),s[5]||(s[5]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[u(" 若您確定曾經註冊過："),e("br"),u(" 請檢查您輸入的電子郵件地址，"),e("br"),u(" 並點選「取消」以重新輸入。 ")],-1)),s[6]||(s[6]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[u(" 若您未曾註冊："),e("br"),u(" 請點選「註冊」以進行註冊。"),e("br"),u(" 註冊即代表您同意我們的 "),e("a",{href:"https://web-tech.tw/#/privacy",class:"text-sky-500 hover:text-sky-700",target:"_blank"}," 隱私權政策 "),u("。 ")],-1)),e("div",{class:"p-6 bg-white border-b border-gray-200 text-right"},[e("button",{class:"bg-amber-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-amber-600 rounded mr-3",onClick:T}," 註冊 "),e("button",{class:"bg-white shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:U}," 取消 ")])])])])])])),V(oe,{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=t=>l.value=t)},null,8,["modelValue"])],64))}};export{je as default};
