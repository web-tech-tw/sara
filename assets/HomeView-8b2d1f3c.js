import{o as u,c as _,a as e,n as F,m as B,u as z,r as f,b as M,d as E,e as K,w as P,v as O,f as Z,g as q,h as I,i as T,j as R,t as m,k as J,l as j,p as W,q as G,F as U,s as Q,x as D,y as H,z as S,A as X,B as Y}from"./index-76b52c22.js";import{b as ee,s as se,u as V,_ as te}from"./ToastModal-9184a42b.js";const N={__name:"LoadingCircleIcon",props:{class:{type:String,required:!1,default:()=>""}},setup(x){const d=x;return(s,t)=>(u(),_("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:F(d.class)},t[0]||(t[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M 3 11.958 C 3.205 6.522 7.226 2.994 11.995 2.993 L 11.954 1.007 C 5.327 1.007 1.002 5.322 1.002 11.949 L 3 11.958 Z M 5.285 17.992 C 3.993 16.533 2.997 13.906 3 11.957 L 1 11.948 C 1 14.99 1.927 17.208 3.792 19.322 L 5.285 17.992 Z"},null,-1)]),2))}};function oe(x,d){return u(),_("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function ne(x,d){return u(),_("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}const ae={class:"input-modal"},re={class:"flex rounded bg-white w-auto h-16 shadow-md md:w-[30rem]"},ie=["placeholder","type","disabled"],le=["disabled"],ue=["disabled"],ce={class:"text-base mt-2"},L={__name:"InputModal",props:B({inputPlaceholder:{type:String,required:!1,default:()=>""},inputDescription:{type:String,required:!1,default:()=>""},inputType:{type:String,required:!1,default:()=>"text"},inputHistory:{type:String,required:!1,default:()=>""},isLoad:{type:Boolean,required:!1,default:()=>!0},isDone:{type:Boolean,required:!1,default:()=>!1},noSubmit:{type:Boolean,required:!1,default:()=>!1}},{modelValue:{type:String},modelModifiers:{}}),emits:B(["submit"],["update:modelValue"]),setup(x,{emit:d}){const s=x,t=z(x,"modelValue"),c=d,a=f(!1),p=M(()=>!!s.inputHistory&&!t.value&&a.value),o=M(()=>s.isLoad||s.isDone),v=()=>{t.value=s.inputHistory,a.value=!1},n=()=>{a.value=!0},b=l=>{document.querySelector(".input-modal").contains(l.target)||(a.value=!1)},r=()=>{c("submit",t.value)};return E(()=>{document.addEventListener("click",b)}),K(()=>{document.removeEventListener("click",b)}),(l,i)=>(u(),_("div",ae,[e("div",re,[P(e("input",{"onUpdate:modelValue":i[0]||(i[0]=h=>t.value=h),class:"w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none focus:outline-none",placeholder:s.inputPlaceholder,type:s.inputType,disabled:o.value,onFocus:n,onKeydown:Z(r,["enter"])},null,40,ie),[[O,t.value]]),s.noSubmit?T("",!0):(u(),_("button",{key:0,class:"m-2 rounded px-4 py-2 font-semibold",disabled:o.value,onClick:r},[s.isDone?(u(),q(I(ne),{key:0,class:"h-6 w-6 my-1"})):s.isLoad?(u(),q(N,{key:1,class:"h-6 w-6 my-1 animate-spin"})):(u(),q(I(oe),{key:2,class:"h-6 w-6 my-1"}))],8,le))]),P(e("button",{class:"w-[90%] mx-auto flex items-center space-x-2 bg-white-500 shadow-md text-md text-slate-700 font-normal py-3 md:px-8 px-4 hover:bg-slate-100 rounded mt-1 animate-fade",disabled:o.value,onClick:v},m(s.inputHistory),9,ue),[[R,p.value]]),e("p",ce,m(s.description),1)]))}},de={class:"flex justify-center my-8 py-16"},pe={class:"flex flex-col mx-5"},me={key:0,class:"flex justify-center mt-5"},ye={key:1,class:"flex justify-center mt-5"},fe="請輸入您的電子郵件地址：",xe="例如：sara@web-tech.tw",be="email",ve={__name:"CreateTokenRequest",emits:["state","status"],setup(x,{emit:d}){const s=f(""),t=f(""),c=f(!1),a=f(!1),p=f(!1),o=M(()=>ee()),v=M(()=>!!t.value),n=d,b=async()=>{const{value:y}=s;if(!y){n("status",{message:"請輸入電子郵件地址"});return}c.value=!0,await l(y),c.value=!1},r=()=>{Q(),t.value="",n("status",{message:"成功清除登入記錄"})},l=async y=>{var $;const w=V();try{p.value=!0;const C=await w.post("tokens/passkeys",{json:{email:y}}),{session_id:g,session_options:k}=await C.json(),A=await se({optionsJSON:k});await w.patch("tokens/passkeys",{json:{session_id:g,credential:A}}),a.value=!0,n("status",{message:"登入成功，正在寫入憑證..."}),D(y),H()}catch(C){console.error(C);const g=(($=C==null?void 0:C.response)==null?void 0:$.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${g})`}),p.value=!1}},i=async y=>{var $,C;const w=V();try{const k=await(await w.post("tokens",{json:{email:y}})).json();if(!(k!=null&&k.session_id)){n("status",{message:"發生錯誤 (無錯誤代碼)"});return}n("state",{name:"CreateTokenVerify",props:{sessionId:k.session_id,sessionTm:k.session_tm,sessionUa:k.session_ua,sessionIp:k.session_ip,currentMail:y}})}catch(g){if((($=g==null?void 0:g.response)==null?void 0:$.status)===404){n("state",{name:"CreateTokenEmpty",props:{currentMail:y}});return}console.error(g);const k=((C=g==null?void 0:g.response)==null?void 0:C.status)||"無錯誤代碼";n("status",{message:`發生錯誤 (${k})`})}},h=async y=>{if(!y){n("status",{message:"請輸入電子郵件地址"});return}c.value=!0,await i(y),c.value=!1};return E(()=>{t.value=J()}),(y,w)=>(u(),_(U,null,[e("div",de,[e("div",pe,[e("label",{class:"input-label text-base mb-2"},m(fe)),j(L,{modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=$=>s.value=$),"input-placeholder":xe,"input-type":be,"input-history":t.value,"is-load":c.value,"is-done":a.value,"no-submit":p.value,onSubmit:h},null,8,["modelValue","input-history","is-load","is-done","no-submit"])])]),o.value?(u(),_("div",me,[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:b},[e("span",null,[a.value?(u(),q(I(W),{key:0,class:"h-5 w-5"})):T("",!0),c.value?(u(),q(N,{key:1,class:"h-5 w-5 animate-spin"})):(u(),q(I(G),{key:2,class:"h-5 w-5"}))]),w[1]||(w[1]=e("span",{class:"font-bold"}," Passkey ",-1))])])):T("",!0),v.value?(u(),_("div",ye,[e("button",{class:"flex items-center space-x-2 bg-white-500 text-sm text-black font-bold py-1 md:px-3 px-4 hover:bg-slate-100 rounded mr-3",onClick:r},w[2]||(w[2]=[e("span",{class:"font-bold"}," 清除登入記錄 ",-1)]))])):T("",!0)],64))}},he={class:"flex justify-center my-8 py-16"},_e={class:"flex flex-col mx-auto"},ge={class:"max-w-2xl mx-auto sm:px-6 lg:px-8"},we={class:"overflow-hidden shadow-md"},ke={class:"p-6 bg-white border-b border-gray-200"},Ce={class:"text-slate-900 my-3"},Se={__name:"CreateTokenEmpty",props:{currentMail:{type:String,required:!0}},emits:["state"],setup(x,{emit:d}){const s=x,t=d,c=()=>{t("state",{name:"CreateUserRequest",props:{currentMail:s.currentMail}})},a=()=>{location.reload()};return(p,o)=>(u(),_("div",he,[e("div",_e,[e("div",ge,[e("div",we,[o[2]||(o[2]=e("div",{class:"px-6 py-4 bg-white border-b border-gray-200 font-bold"}," 尚未註冊 ",-1)),e("div",ke,[o[0]||(o[0]=S(" 您好，您輸入的電子郵件地址： ")),e("div",Ce,m(s.currentMail),1),o[1]||(o[1]=S(" 尚未於 Sara 系統註冊帳號。 "))]),o[3]||(o[3]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您確定曾經註冊過："),e("br"),S(" 請檢查您輸入的電子郵件地址，"),e("br"),S(" 並點選「取消」以重新輸入。 ")],-1)),o[4]||(o[4]=e("div",{class:"p-6 bg-white border-b border-gray-200"},[S(" 若您未曾註冊："),e("br"),S(" 請點選「註冊」以進行註冊。"),e("br"),S(" 註冊即代表您同意我們的 "),e("a",{href:"https://web-tech.tw/#/privacy",class:"text-sky-500 hover:text-sky-700",target:"_blank"}," 隱私權政策 "),S("。 ")],-1)),e("div",{class:"p-6 bg-white border-b border-gray-200 text-right"},[e("button",{class:"bg-amber-500 shadow-md text-sm text-white font-bold py-3 md:px-8 px-4 hover:bg-amber-600 rounded mr-3",onClick:c}," 註冊 "),e("button",{class:"bg-white shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded",onClick:a}," 取消 ")])])])])]))}},$e={class:"flex justify-center my-8 py-16"},qe={class:"flex flex-col mx-5"},Me={class:"text-center text-slate-700 mt-5 text-sm"},Ve={class:"text-center text-slate-700 mt-5 text-sm"},je="請輸入您的登入代碼：",Ue="例如：123456",Te={__name:"CreateTokenVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["status"],setup(x,{emit:d}){const s=x,t=d,c=`請於您的電子郵件信箱 ${s.currentMail} 收取登入代碼。`,a=f(""),p=f(!1),o=f(!1),v=()=>{location.reload()},n=async r=>{var i;const l=V();try{await l.patch("tokens",{json:{session_id:s.sessionId,code:r}}),o.value=!0,t("status",{message:"登入成功，正在寫入憑證..."}),D(s.currentMail),H()}catch(h){console.error(h);const y=((i=h==null?void 0:h.response)==null?void 0:i.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${y})`})}},b=async r=>{if(!r){t("status",{message:"請輸入登入代碼"});return}p.value=!0,await n(r),p.value=!1};return(r,l)=>(u(),_(U,null,[e("div",$e,[e("div",qe,[e("label",{class:"input-label text-base mb-2"},m(je)),j(L,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=i=>a.value=i),"input-description":c,"input-placeholder":Ue,"is-load":p.value,"is-done":o.value,onSubmit:b},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:v}," 取消 ")]),e("div",Me,[e("div",null,"申請時間："+m(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+m(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+m(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+m(s.sessionIp||"未知"),1)]),e("div",Ve,[e("div",null,"目標電子郵件地址："+m(s.currentMail||"未知"),1)])],64))}},Ie={class:"flex justify-center my-8 py-16"},Le={class:"flex flex-col mx-5"},Pe={class:"text-center text-slate-700 mt-5 text-sm"},De="請輸入您的暱稱：",He="例如：星川 サラ",Be={__name:"CreateUserRequest",props:{currentMail:{type:String,required:!0}},emits:["state","status"],setup(x,{emit:d}){const s=x,t=d,c=f(""),a=f(!1),p=()=>{location.reload()},o=async n=>{var r;const b=V();try{const i=await(await b.post("users",{json:{email:s.currentMail,nickname:n}})).json();t("state",{name:"CreateUserVerify",props:{sessionId:i.session_id,sessionTm:i.session_tm,sessionUa:i.session_ua,sessionIp:i.session_ip,currentMail:s.currentMail}})}catch(l){console.error(l);const i=((r=l==null?void 0:l.response)==null?void 0:r.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${i})`})}},v=async n=>{if(!n){t("status",{message:"請輸入暱稱"});return}a.value=!0,await o(n),a.value=!1};return(n,b)=>(u(),_(U,null,[e("div",Ie,[e("div",Le,[e("label",{class:"input-label text-base mb-2"},m(De)),j(L,{modelValue:c.value,"onUpdate:modelValue":b[0]||(b[0]=r=>c.value=r),"input-placeholder":He,"is-load":a.value,onSubmit:v},null,8,["modelValue","is-load"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:p}," 取消 ")]),e("div",Pe,[e("div",null,"目標電子郵件地址："+m(s.currentMail||"未知"),1)])],64))}},Ee={class:"flex justify-center my-8 py-16"},Re={class:"flex flex-col mx-5"},Ne={class:"text-center text-slate-700 mt-5 text-sm"},Ae={class:"text-center text-slate-700 mt-5 text-sm"},Fe="請輸入您的註冊代碼：",ze="例如：1234567",Ke={__name:"CreateUserVerify",props:{sessionId:{type:String,required:!0},sessionTm:{type:String,required:!0},sessionUa:{type:String,required:!0},sessionIp:{type:String,required:!0},currentMail:{type:String,required:!0}},emits:["state","status"],setup(x,{emit:d}){const s=x,t=d,c=`請於您的電子郵件信箱 ${s.currentMail} 收取註冊代碼。`,a=f(""),p=f(!1),o=f(!1),v=()=>{location.reload()},n=async r=>{var i;const l=V();try{await l.patch("users",{json:{session_id:s.sessionId,code:r}}),o.value=!0,t("status",{message:"註冊成功，正在寫入憑證..."}),D(s.currentMail),H()}catch(h){console.error(h);const y=((i=h==null?void 0:h.response)==null?void 0:i.status)||"無錯誤代碼";t("status",{message:`發生錯誤 (${y})`})}},b=async r=>{if(!r){t("status",{message:"請輸入註冊代碼"});return}p.value=!0,await n(r),p.value=!1};return(r,l)=>(u(),_(U,null,[e("div",Ee,[e("div",Re,[e("label",{class:"input-label text-base mb-2"},m(Fe)),j(L,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=i=>a.value=i),"input-description":c,"input-placeholder":ze,"is-load":p.value,"is-done":o.value,onSubmit:b},null,8,["modelValue","is-load","is-done"])])]),e("div",{class:"flex justify-center mt-5"},[e("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:v}," 取消 ")]),e("div",Ne,[e("div",null,"申請時間："+m(s.sessionTm||"未知"),1),e("div",null,"申請識別碼："+m(s.sessionId||"未知"),1),e("div",null,"申請來源裝置："+m(s.sessionUa||"未知"),1),e("div",null,"申請來源 IP 位址："+m(s.sessionIp||"未知"),1)]),P(e("div",Ae,[e("div",null,"目標電子郵件地址："+m(s.currentMail||"未知"),1)],512),[[R,s.currentMail]])],64))}},Je={__name:"HomeView",setup(x){const d=f("CreateTokenRequest"),s=f(null),t=f(""),c={CreateTokenRequest:ve,CreateTokenEmpty:Se,CreateTokenVerify:Te,CreateUserRequest:Be,CreateUserVerify:Ke},a=M(()=>c[d.value]),p=({name:v,props:n})=>{d.value=v,s.value=n??{},requestAnimationFrame(()=>{window.scroll({behavior:"smooth",top:0})})},o=({message:v})=>{t.value=v};return(v,n)=>(u(),_(U,null,[(u(),q(Y(a.value),X(s.value,{onState:p,onStatus:o}),null,16)),j(te,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=b=>t.value=b)},null,8,["modelValue"])],64))}};export{Je as default};
