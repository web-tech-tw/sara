import{r,u as S,c as i,o as j,a as C,b as $,d as u,t as E,e as g,F as I,h as R,j as q}from"./index-395a3c98.js";import{_ as B}from"./InputModal-261cdbc1.js";import{_ as M}from"./ToastModal-8587db35.js";const F={class:"flex justify-center my-8 py-16"},N={class:"flex flex-col mx-5"},U={class:"input-label text-base mb-2"},W={__name:"RegisterView",props:{email:{type:String,required:!0}},setup(A){const m=r(!1),a=r(""),p=r(""),o=r(""),c=r(""),d=S(),v=q(),_=i(()=>o.value?"請輸入您的註冊代碼：":"請輸入您的暱稱："),f=i(()=>o.value?"例如：1234567":"例如：星川 サラ"),y=i(()=>o.value?`請於您的電子郵件信箱 ${p.value} 收取註冊代碼。`:""),x=i(()=>o.value?"text":"email"),b=i(()=>o.value?"請輸入註冊代碼":"請輸入暱稱"),h=()=>{window.history.length?d.back():d.replace("/")},w=async s=>{if(!s){a.value=b.value;return}a.value="",m.value=!0,o.value?await k(s):await V(s),m.value=!1},V=async s=>{var e;const t=sessionStorage.getItem("sara_register_email");try{const n=await(await v.post("users",{json:{email:t,nickname:s}})).json();n!=null&&n.session_id?(o.value=n.session_id,p.value=c.value,c.value=""):a.value="發生錯誤 (無錯誤代碼)"}catch(l){const n=((e=l==null?void 0:l.response)==null?void 0:e.status)||"無錯誤代碼";a.value=`發生錯誤 (${n})`,console.error(l.message)}},k=async s=>{var t;try{await v.patch("users",{json:{session_id:o.value,code:s}}),a.value="註冊成功，正在寫入憑證...",sessionStorage.removeItem("sara_register_email"),R()}catch(e){const l=((t=e==null?void 0:e.response)==null?void 0:t.status)||"無錯誤代碼";a.value=`發生錯誤 (${l})`,console.error(e.message)}};return j(()=>{sessionStorage.getItem("sara_register_email")||d.replace("/")}),(s,t)=>(C(),$(I,null,[u("div",F,[u("div",N,[u("label",U,E(_.value),1),g(B,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),loading:m.value,placeholder:f.value,description:y.value,"input-type":x.value,onSubmit:w},null,8,["modelValue","loading","placeholder","description","input-type"])])]),u("div",{class:"flex justify-center mt-5"},[u("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:h}," 取消 ")]),g(M,{modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value=e)},null,8,["modelValue"])],64))}};export{W as default};
