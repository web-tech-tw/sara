import{r as l,u as M,c as i,a as g,b,d as o,t as r,e as h,g as N,F as R,j as T}from"./index-d0a8f5f0.js";import{_ as U}from"./InputModal-38a8e617.js";import{_ as q}from"./ToastModal-cef008e2.js";const E={class:"flex justify-center my-8 py-16"},F={class:"flex flex-col mx-5"},L={class:"input-label text-base mb-2"},P={key:0,class:"text-center text-slate-700 mt-5 text-sm"},H={__name:"ManageEmailView",setup(W){const d=l(!1),m=l(!1),n=l(""),p=l(""),t=l(""),f=l(""),_=l(""),x=l(""),c=l(""),v=M(),y=T(),w=i(()=>t.value?"請輸入您的轉移代碼：":"請輸入新的電子郵件地址："),V=i(()=>t.value?"例如：12345678":"例如：sara@web-tech.tw"),k=i(()=>t.value?`請於新的電子郵件信箱 ${p.value} 收取轉移代碼。`:""),C=i(()=>t.value?"text":"email"),j=i(()=>t.value?"請輸入轉移代碼":"請輸入電子郵件地址"),S=i(()=>!!t.value),$=()=>{window.history.length?v.back():v.replace("/")},B=async u=>{if(!u){n.value=j.value;return}n.value="",d.value=!0,t.value?await I(u):await D(u),d.value=!1},D=async u=>{var a;try{const s=await(await y.put("users/me/email",{json:{email:u}})).json();s!=null&&s.session_id?(t.value=s.session_id,f.value=s.session_ua,_.value=s.session_ip,x.value=s.session_tm,p.value=c.value,c.value=""):n.value="發生錯誤 (無錯誤代碼)"}catch(e){const s=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";n.value=`發生錯誤 (${s})`,console.error(e.message)}},I=async u=>{var a;try{await y.patch("users/me/email",{json:{session_id:t.value,code:u}}),m.value=!0,n.value="修改成功，正在寫入憑證...",setTimeout(()=>v.replace("/manage"),500)}catch(e){const s=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";n.value=`發生錯誤 (${s})`,console.error(e.message)}};return(u,a)=>(g(),b(R,null,[o("div",E,[o("div",F,[o("label",L,r(w.value),1),h(U,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),loading:d.value,done:m.value,placeholder:V.value,description:k.value,"input-type":C.value,onSubmit:B},null,8,["modelValue","loading","done","placeholder","description","input-type"])])]),o("div",{class:"flex justify-center mt-5"},[o("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:$}," 取消 ")]),S.value?(g(),b("div",P,[o("div",null,"申請時間："+r(x.value||"未知"),1),o("div",null,"申請識別碼："+r(t.value||"未知"),1),o("div",null,"申請來源裝置："+r(f.value||"未知"),1),o("div",null,"申請來源 IP 位址："+r(_.value||"未知"),1)])):N("",!0),h(q,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e)},null,8,["modelValue"])],64))}};export{H as default};
