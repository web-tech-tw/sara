import{r as u,u as M,c as i,a as y,b as g,d as l,t as r,e as b,g as N,F as R,j as T}from"./index-264cd9b1.js";import{_ as U}from"./InputModal-599f3a07.js";import{_ as q}from"./ToastModal-0a1d87d8.js";const D={class:"flex justify-center my-8 py-16"},E={class:"flex flex-col mx-5"},F={class:"input-label text-base mb-2"},L={key:0,class:"text-center text-slate-700 mt-5 text-sm"},G={__name:"ManageEmailView",setup(P){const d=u(!1),o=u(""),v=u(""),t=u(""),p=u(""),_=u(""),f=u(""),c=u(""),m=M(),x=T(),h=i(()=>t.value?"請輸入您的轉移代碼：":"請輸入新的電子郵件地址："),w=i(()=>t.value?"例如：12345678":"例如：sara@web-tech.tw"),V=i(()=>t.value?`請於新的電子郵件信箱 ${v.value} 收取轉移代碼。`:""),k=i(()=>t.value?"text":"email"),C=i(()=>t.value?"請輸入轉移代碼":"請輸入電子郵件地址"),j=i(()=>!!t.value),S=()=>{window.history.length?m.back():m.replace("/")},$=async n=>{if(!n){o.value=C.value;return}o.value="",d.value=!0,t.value?await I(n):await B(n),d.value=!1},B=async n=>{var a;try{const s=await(await x.put("users/me/email",{json:{email:n}})).json();s!=null&&s.session_id?(t.value=s.session_id,p.value=s.session_ua,_.value=s.session_ip,f.value=s.session_tm,v.value=c.value,c.value=""):o.value="發生錯誤 (無錯誤代碼)"}catch(e){const s=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";o.value=`發生錯誤 (${s})`,console.error(e.message)}},I=async n=>{var a;try{await x.patch("users/me/email",{json:{session_id:t.value,code:n}}),o.value="修改成功，正在寫入憑證...",setTimeout(()=>m.replace("/manage"),500)}catch(e){const s=((a=e==null?void 0:e.response)==null?void 0:a.status)||"無錯誤代碼";o.value=`發生錯誤 (${s})`,console.error(e.message)}};return(n,a)=>(y(),g(R,null,[l("div",D,[l("div",E,[l("label",F,r(h.value),1),b(U,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),loading:d.value,placeholder:w.value,description:V.value,"input-type":k.value,onSubmit:$},null,8,["modelValue","loading","placeholder","description","input-type"])])]),l("div",{class:"flex justify-center mt-5"},[l("button",{class:"flex items-center space-x-2 bg-white-500 shadow-md text-sm text-black font-bold py-3 md:px-8 px-4 hover:bg-slate-100 rounded mr-3",onClick:S}," 取消 ")]),j.value?(y(),g("div",L,[l("div",null,"申請時間："+r(f.value||"未知"),1),l("div",null,"申請識別碼："+r(t.value||"未知"),1),l("div",null,"申請來源裝置："+r(p.value||"未知"),1),l("div",null,"申請來源 IP 位址："+r(_.value||"未知"),1)])):N("",!0),b(q,{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value=e)},null,8,["modelValue"])],64))}};export{G as default};
